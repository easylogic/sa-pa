import{inherits as t,createSuper as e,createClass as r,classCallCheck as i,slicedToArray as n,toArray as o,get as a,getPrototypeOf as s}from"./_virtual/_rollupPluginBabelHelpers.js";import{CHECK_SUBSCRIBE_PATTERN as l,SUBSCRIBE_SAPARATOR as c,CHECK_SAPARATOR as u}from"./Event.js";import f from"./EventMachine.js";import{splitMethodByKeyword as h,isFunction as v}from"./functions/func.js";import{uuidShort as y}from"./functions/uuid.js";var d=function(d){t(g,f);var p=e(g);function g(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(this,g),(e=p.call(this,t,r)).__UID=new Set,r.store&&(e.__storeInstance=r.store),e.created(),e.initialize(),e.initializeStoreEvent(),e}return r(g,[{key:"setStore",value:function(t){this.__storeInstance=t}},{key:"$store",get:function(){return this.__storeInstance||this.parent.$store}},{key:"created",value:function(){}},{key:"getRealEventName",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:MULTI_PREFIX,r=t.indexOf(e);return t.substr(r<0?0:r+e.length)}},{key:"splitMethod",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=h(t,e),o=n(i,2),a=o[0],s=o[1];return[a.length?+s[0].target:r,a,s]}},{key:"createLocalCallback",value:function(t,e){var r=e.bind(this);return r.displayName="".concat(this.sourceName,".").concat(t),r.source=this.source,r}},{key:"initializeStoreEvent",value:function(){var t=this;this.filterProps(l).forEach((function(e){var r=t.getRealEventName(e,c),i=r.split(u),a=o(i);a[0];var s=a.slice(1),l=s.map((function(t){return t.trim()})).filter((function(e){return t[e]})).map((function(t){return{target:t}})),f=t.splitMethod(s,"debounce"),h=n(f,2),y=h[0],d=h[1],p=t.splitMethod(s,"throttle"),g=n(p,2),k=g[0],m=g[1],b=t.splitMethod(s,"allTrigger"),E=n(b,2);E[0];var $=E[1],S=t.splitMethod(s,"selfTrigger"),_=n(S,2);_[0];var x=_[1];r.split(u).filter((function(t){return-1===l.indexOf(t)&&-1===d.indexOf(t)&&-1===$.indexOf(t)&&-1===x.indexOf(t)&&-1===m.indexOf(t)})).map((function(t){return t.trim()})).filter(Boolean).forEach((function(r){if(v(t[e])){var i=t.createLocalCallback(r,t[e]);t.$store.on(r,i,t,y,k,$.length,x.length,l)}}))}))}},{key:"destoryStoreSUBSCRIBE",value:function(){this.$store.offAll(this)}},{key:"destroy",value:function(){a(s(g.prototype),"destroy",this).call(this),this.destoryStoreSUBSCRIBE()}},{key:"rerender",value:function(){a(s(g.prototype),"rerender",this).call(this),this.initialize(),this.initializeStoreEvent()}},{key:"emit",value:function(t){var e;this.$store.source=this.source,this.$store.sourceContext=this;for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];(e=this.$store).emit.apply(e,[t].concat(i))}},{key:"nextTick",value:function(t){this.$store.nextTick(t)}},{key:"trigger",value:function(t){var e;this.$store.source=this.source;for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];(e=this.$store).trigger.apply(e,[t].concat(i))}},{key:"broadcast",value:function(t){for(var e=this,r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];Object.keys(this.children).forEach((function(r){var n;(n=e.children[r]).trigger.apply(n,[t].concat(i))}))}},{key:"on",value:function(t,e){this.$store.on(t,e)}},{key:"off",value:function(t,e){this.$store.off(t,e)}},{key:"subscribe",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i="subscribe.".concat(y()),n=this.createLocalCallback(i,t);return this.$store.on(i,n,this,e,r,!1,!0),i}}]),g}();export{d as default};
