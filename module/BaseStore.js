import{createClass as e,classCallCheck as a}from"./_virtual/_rollupPluginBabelHelpers.js";import"./EventMachine.js";import{isFunction as t,debounce as l,throttle as n,ifCheck as s}from"./functions/func.js";var i=function(){function i(e){a(this,i),this.cachedCallback={},this.callbacks={},this.commandes=[],this.editor=e}return e(i,[{key:"getCallbacks",value:function(e){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e]}},{key:"setCallbacks",value:function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.callbacks[e]=a}},{key:"debug",value:function(){var e;this.editor&&this.editor.config.get("debug")&&(e=console).debug.apply(e,arguments)}},{key:"on",value:function(e,a,t){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],h=a;return r>0?h=l(a,r):c>0&&(h=n(a,c)),g.length&&(h=s(h,t,g)),this.getCallbacks(e).push({event:e,callback:h,context:t,originalCallback:a,enableAllTrigger:o,enableSelfTrigger:u}),this.debug("add message event",e,t.sourceName),function(){i.off(e,a)}}},{key:"off",value:function(e,a){this.debug("off message event",e),1==arguments.length?this.setCallbacks(e):2==arguments.length&&this.setCallbacks(e,this.getCallbacks(e).filter((function(e){return e.originalCallback!==a})))}},{key:"offAll",value:function(e){var a=this;Object.keys(this.callbacks).forEach((function(t){a.setCallbacks(t,a.getCallbacks(t).filter((function(a){return a.context!==e})))})),this.debug("off all message",e.sourceName)}},{key:"getCachedCallbacks",value:function(e){return this.getCallbacks(e)}},{key:"sendMessage",value:function(e,a){for(var t=this,l=arguments.length,n=new Array(l>2?l-2:0),s=2;s<l;s++)n[s-2]=arguments[s];Promise.resolve().then((function(){var l=t.getCachedCallbacks(a);if(l)for(var s=0,i=l.length;s<i;s++){var r=l[s];r.enableSelfTrigger||(r.enableAllTrigger||r.originalCallback.source!==e)&&r.callback.apply(r.context,n)}}))}},{key:"nextSendMessage",value:function(e,a){for(var t=arguments.length,l=new Array(t>2?t-2:0),n=2;n<t;n++)l[n-2]=arguments[n];Promise.resolve().then((function(){a.apply(void 0,l)}))}},{key:"triggerMessage",value:function(e,a){for(var t=this,l=arguments.length,n=new Array(l>2?l-2:0),s=2;s<l;s++)n[s-2]=arguments[s];Promise.resolve().then((function(){var l=t.getCachedCallbacks(a);if(l)for(var s=0,i=l.length;s<i;s++){var r=l[s];r.originalCallback.source===e&&r.callback.apply(r.context,n)}else console.warn(a," is not valid event")}))}},{key:"emit",value:function(e){for(var a=arguments.length,l=new Array(a>1?a-1:0),n=1;n<a;n++)l[n-1]=arguments[n];t(e)?e.apply(void 0,l):this.sendMessage.apply(this,[this.source,e].concat(l))}},{key:"nextTick",value:function(e){this.nextSendMessage(this.source,e)}},{key:"trigger",value:function(e){for(var a=arguments.length,l=new Array(a>1?a-1:0),n=1;n<a;n++)l[n-1]=arguments[n];t(e)?e.apply(void 0,l):this.triggerMessage.apply(this,[this.source,e].concat(l))}}]),i}();export{i as default};
