function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t}).apply(this,arguments)}const e="@magic:",r=(t,e=h)=>` ${e} ${t}`,s=/domevent (.*)/gi,i=/load (.*)/gi,n=/bind (.*)/gi,a=/subscribe (.*)/gi,l=(...t)=>t.join("|"),o=":",h="|",c="@magic:domevent ",d="@magic:load ",u="@magic:bind ",p="@magic:subscribe ",f=" ",g={},m=(...t)=>{var e=t.join(":");return(...t)=>"@magic:domevent "+[e].concat(t).join(" ")},v=(...t)=>"@magic:subscribe "+t.join(h),b=(t,e=h)=>r(t,e),y=(t,e=h)=>r(`after(${t})`,e),x=(t,e=h)=>r(`before(${t})`,e),C=b,E=b,T=b("ArrowUp"),k=b("ArrowDown"),w=b("ArrowLeft"),M=b("ArrowRight"),S=b("Enter"),N=b("Space"),$=b("Escape"),L=b("isAltKey"),_=b("isShiftKey"),D=b("isMetaKey"),A=b("isCtrlKey"),O=b("hasMouse"),P=b("hasTouch"),j=b("hasPen"),R=b("self"),B=b("isMouseLeftButton"),H=b("isMouseRightButton"),I=b("fit"),V=b("passive"),z=b("domdiff"),F=(t=100)=>b(`debounce(${t})`),K=(t=300)=>b(`delay(${t})`),X=F(1e3),U=(t=100)=>b(`throttle(${t})`),W=b("allTrigger()"),G=b("selfTrigger()"),Y=b("capture()"),q=y("preventDefault"),J=y("stopPropagation"),Q=v,Z=(...t)=>v.apply(void 0,t.concat([W])),tt=(...t)=>v.apply(void 0,t.concat([G])),et=(t,...e)=>v.apply(void 0,[`config:${t}`].concat(e)),rt=m,st=m("click"),it=m("dblclick"),nt=m("mousedown"),at=m("mouseup"),lt=m("mousemove"),ot=m("mouseover"),ht=m("mouseout"),ct=m("mouseenter"),dt=m("mouseleave"),ut=m("touchstart"),pt=m("touchmove"),ft=m("touchend"),gt=m("keydown"),mt=m("keyup"),vt=m("keypress"),bt=m("drag"),yt=m("dragstart"),xt=m("drop"),Ct=m("dragover"),Et=m("dragenter"),Tt=m("dragleave"),kt=m("dragexit"),wt=m("dragout"),Mt=m("dragend"),St=m("contextmenu"),Nt=m("change"),$t=m("input"),Lt=m("focus"),_t=m("focusin"),Dt=m("focusout"),At=m("blur"),Ot=m("paste"),Pt=m("resize"),jt=m("scroll"),Rt=m("submit"),Bt=(...t)=>rt("pointerdown").apply(void 0,t)+B,Ht=rt("pointerover"),It=rt("pointerenter"),Vt=rt("pointerout"),zt=rt("pointermove"),Ft=rt("pointerup"),Kt=rt("change","input"),Xt=rt("wheel","mousewheel","DOMMouseScroll"),Ut=m("animationstart"),Wt=m("animationend"),Gt=m("animationiteration"),Yt=m("transitionstart"),qt=m("transitionend"),Jt=m("transitionrun"),Qt=m("transitioncancel"),Zt=rt("doubletab"),te=(t="$el")=>"@magic:load "+t,ee=t=>g[t]||"",re=t=>function(){return this.prevState[t]!=this.state[t]},se=()=>!0,ie=(t="$el")=>"@magic:bind "+t;function ne(t){let e=t.deltaX,r=t.deltaY;return 0===e&&t.shiftKey&&([r,e]=[e,r]),t.deltaMode===WheelEvent.DOM_DELTA_LINE?r*=8:t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(r*=24),[ae(e,24),ae(r,24),0]}function ae(t,e){return Math.sign(t)*Math.min(e,Math.abs(t))}var le={addDomEvent(t,e,r,s=!1){t&&t.addEventListener(e,r,s)},removeDomEvent(t,e,r){t&&t.removeEventListener(e,r)},pos:t=>t.touches&&t.touches[0]?t.touches[0]:t,posXY(t){var e=this.pos(t);return{x:e.pageX,y:e.pageY}}};const oe=(t,e,r,s)=>{r?s&&r===s||((t,e,r)=>{"boolean"==typeof r?((t,e,r)=>{r?(t.setAttribute(e,e),t[e]=r):(t.removeAttribute(e),t[e]=r)})(t,e,r):t.setAttribute(e,r)})(t,e,r):((t,e,r)=>{"boolean"==typeof r?((t,e)=>{t.removeAttribute(e),t[e]=!1})(t,e):e&&((t,e)=>{t.removeAttribute(e)})(t,e)})(t,e,s)};function he(t){return t.nodeType!==Node.TEXT_NODE&&"true"===t.getAttribute("data-domdiff-pass")}function ce(t){var e={};const r=t.length;for(let s=0;s<r;s++){const r=t[s];e[r.name]=r.value}return e}function de(t,e,r,s){if(e)if(r){if(he(e)||he(r));else if(o=e,(l=r).nodeType===Node.TEXT_NODE&&l.textContent!==o.textContent||l.nodeName!==o.nodeName||function(t){return t.nodeType!==Node.TEXT_NODE&&t.getAttribute("refClass")}(r))t.replaceChild(r.cloneNode(!0),e);else if(r.nodeType!==Node.TEXT_NODE&&r.nodeType!==Node.COMMENT_NODE&&"[object HTMLUnknownElement]"!==r.toString()){((t,e={},r={})=>{const s=[];s.push.apply(s,Object.keys(e)),s.push.apply(s,Object.keys(r));const i=[].concat(new Set(s));for(var n=0,a=i.length;n<a;n++){const s=i[n];oe(t,s,e[s],r[s])}})(e,ce(r.attributes),ce(e.attributes));var i=ue(e),n=ue(r),a=Math.max(i.length,n.length);for(s=0;s<a;s++)de(e,i[s],n[s],s)}}else t.removeChild(e);else t.appendChild(r.cloneNode(!0));var l,o}const ue=t=>{var e=t.firstChild;if(!e)return[];var r=[];do{r.push(e),e=e.nextSibling}while(e);return r};function pe(t,e){e=e.el||e;for(var r=ue(t=t.el||t),s=ue(e),i=Math.max(r.length,s.length),n=0;n<i;n++)de(t,r[n],s[n],n)}class fe{constructor(t,e,r){if("string"!=typeof t)this.el=t;else{var s=document.createElement(t);for(var i in e&&(s.className=e),r=r||{})s.setAttribute(i,r[i]);this.el=s}}static create(t,e,r){return new fe(t,e,r)}static createByHTML(t){var e=fe.create("div").html(t).children();return e.length?fe.create(e[0].el):null}static getScrollTop(){return Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)}static getScrollLeft(){return Math.max(window.pageXOffset,document.documentElement.scrollLeft,document.body.scrollLeft)}static parse(t){return DOMParser().parseFromString(t,"text/htmll")}static body(){return fe.create(document.body)}setAttr(t){return Object.keys(t).forEach(e=>{this.attr(e,t[e])}),this}setAttrNS(t,e="http://www.w3.org/2000/svg"){return Object.keys(t).forEach(r=>{this.attr(r,t[r],e)}),this}setProp(t){return Object.keys(t).forEach(e=>{this.el[e]!=t[e]&&(this.el[e]=t[e])}),this}data(t,e){return 1===arguments.length?this.attr("data-"+t):2===arguments.length?this.attr("data-"+t,e):this}attr(t,e){return 1==arguments.length?this.el.getAttribute(t):(this.el.getAttribute(t)!=e&&this.el.setAttribute(t,e),this)}attrNS(t,e,r="http://www.w3.org/2000/svg"){return 1==arguments.length?this.el.getAttributeNS(r,t):(this.el.getAttributeNS(r,t)!=e&&this.el.setAttributeNS(r,t,e),this)}attrKeyValue(t){return{[this.el.getAttribute(t)]:this.val()}}attrs(...t){return t.map(t=>this.el.getAttribute(t))}styles(...t){return t.map(t=>this.el.style[t])}removeAttr(t){return this.el.removeAttribute(t),this}removeStyle(t){return this.el.style.removeProperty(t),this}is(t){return this.el===(t.el||t)}isTag(t){return this.el.tagName.toLowerCase()===t.toLowerCase()}closest(t){for(var e=this,r=!1;!(r=e.hasClass(t));){if(!e.el.parentNode)return null;e=fe.create(e.el.parentNode)}return r?e:null}path(){if(!this.el)return[];const t=this.parent();return t?[].concat(t.path(),[this]):[this]}parent(){return fe.create(this.el.parentNode)}hasParent(){return!!this.el.parentNode}removeClass(...t){var e;return(e=this.el.classList).remove.apply(e,t),this}hasClass(t){return!!this.el.classList&&this.el.classList.contains(t)}addClass(...t){var e;return(e=this.el.classList).add.apply(e,t),this}onlyOneClass(t){this.parent().children().forEach(e=>{e.removeClass(t)}),this.addClass(t)}toggleClass(t,e){return this.el.classList.toggle(t,e),this}html(t){return void 0===t?this.el.innerHTML:("string"==typeof t?this.el.innerHTML=t:this.empty().append(t),this)}htmlDiff(t){pe(this,t)}updateDiff(t,e="div"){pe(this,fe.create(e).html(t))}updateSVGDiff(t,e="div"){pe(this,fe.create(e).html(`<svg>${t}</svg>`).firstChild.firstChild)}find(t){return this.el.querySelector(t)}$(t){var e=this.find(t);return e?fe.create(e):null}findAll(t){return Array.from(this.el.querySelectorAll(t))}$$(t){return this.findAll(t).map(t=>fe.create(t))}empty(){for(;this.el.firstChild;)this.el.removeChild(this.el.firstChild);return this}append(t){return this.el.appendChild("string"==typeof t?document.createTextNode(t):t.el||t),this}prepend(t){return this.el.prepend("string"==typeof t?document.createTextNode(t):t.el||t),this}prependHTML(t){var e=fe.create("div").html(t);return this.prepend(e.createChildrenFragment()),e}appendHTML(t){var e=fe.create("div").html(t);return this.append(e.createChildrenFragment()),e}createChildrenFragment(){const t=this.children();var e=document.createDocumentFragment();return t.forEach(t=>e.appendChild(t.el)),e}appendTo(t){return(t.el?t.el:t).appendChild(this.el),this}remove(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this}removeChild(t){return this.el.removeChild(t.el||t),this}text(t){if(void 0===t)return this.el.textContent;var e=t;return t instanceof fe&&(e=t.text()),this.el.textContent!==e&&(this.el.textContent=e),this}css(t,e){if(void 0!==t&&void 0!==e)0===t.indexOf("--")&&void 0!==e?this.el.style.setProperty(t,e):this.el.style[t]=e;else if(void 0!==t){if("string"==typeof t)return getComputedStyle(this.el)[t];Object.entries(t).forEach(([t,e])=>{0===t.indexOf("--")&&void 0!==e?this.el.style.setProperty(t,e):this.el.style[t]=e})}return this}getComputedStyle(...t){var e=getComputedStyle(this.el),r={};return t.forEach(t=>{r[t]=e[t]}),r}getStyleList(...t){for(var e={},r=this.el.style.length,s=0;s<r;s++){var i=this.el.style[s];e[i]=this.el.style[i]}return t.forEach(t=>{e[t]=this.css(t)}),e}cssText(t){return void 0===t?this.el.style.cssText:(t!=this.el.tempCssText&&(this.el.style.cssText=t,this.el.tempCssText=t),this)}cssArray(t){return t[0]&&(this.el.style[t[0]]=t[1]),t[2]&&(this.el.style[t[2]]=t[3]),t[4]&&(this.el.style[t[4]]=t[5]),t[6]&&(this.el.style[t[6]]=t[7]),t[8]&&(this.el.style[t[8]]=t[9]),this}cssFloat(t){return parseFloat(this.css(t))}cssInt(t){return parseInt(this.css(t))}px(t,e){return this.css(t,`${e}px`)}rect(){return this.el.getBoundingClientRect()}bbox(){return this.el.getBBox()}isSVG(){return"SVG"===this.el.tagName.toUpperCase()}offsetRect(){if(this.isSVG()){const t=this.parent().rect(),e=this.rect();return{x:e.x-t.x,y:e.y-t.y,top:e.x-t.x,left:e.y-t.y,width:e.width,height:e.height}}return{x:this.el.offsetLeft,y:this.el.offsetTop,top:this.el.offsetTop,left:this.el.offsetLeft,width:this.el.offsetWidth,height:this.el.offsetHeight}}offset(){var t=this.rect(),e=fe.getScrollTop(),r=fe.getScrollLeft();return{top:t.top+e,left:t.left+r}}offsetLeft(){return this.offset().left}offsetTop(){return this.offset().top}position(){return this.el.style.top?{top:parseFloat(this.css("top")),left:parseFloat(this.css("left"))}:this.rect()}size(){return[this.width(),this.height()]}width(){return this.el.offsetWidth||this.rect().width}contentWidth(){return this.width()-this.cssFloat("padding-left")-this.cssFloat("padding-right")}height(){return this.el.offsetHeight||this.rect().height}contentHeight(){return this.height()-this.cssFloat("padding-top")-this.cssFloat("padding-bottom")}val(t){if(void 0===t)return this.el.value;if(void 0!==t){var e=t;t instanceof fe&&(e=t.val()),this.el.value=e}return this}matches(t){return this.el&&this.el.matches?this.el.matches(t)?this:this.parent().matches(t):null}get value(){return this.el.value}get naturalWidth(){return this.el.naturalWidth}get naturalHeight(){return this.el.naturalHeight}get files(){return this.el.files?[].concat(this.el.files):[]}realVal(){switch(this.el.nodeType){case"INPUT":var t=this.attr("type");if("checkbox"==t||"radio"==t)return this.checked();case"SELECT":case"TEXTAREA":return this.el.value}return""}int(){return parseInt(this.val(),10)}float(){return parseFloat(this.val())}show(t="block"){return this.el.style.display="none"!=t?t:"block",this}hide(){return this.el.style.display="none",this}isHide(){return"none"===this.el.style.display}isShow(){return!this.isHide()}toggle(t){var e=this.isHide();return 1==arguments.length?t?this.show():this.hide():e?this.show():this.hide()}get totalLength(){return this.el.getTotalLength()}scrollIntoView(){this.el.scrollIntoView()}addScrollLeft(t){return this.el.scrollLeft+=t,this}addScrollTop(t){return this.el.scrollTop+=t,this}setScrollTop(t){return this.el.scrollTop=t,this}setScrollLeft(t){return this.el.scrollLeft=t,this}scrollTop(){return this.el===document.body?fe.getScrollTop():this.el.scrollTop}scrollLeft(){return this.el===document.body?fe.getScrollLeft():this.el.scrollLeft}scrollHeight(){return this.el.scrollHeight}scrollWidth(){return this.el.scrollWidth}on(t,e,r,s){return this.el.addEventListener(t,e,r,s),this}off(t,e){return this.el.removeEventListener(t,e),this}getElement(){return this.el}createChild(t,e="",r={},s={}){let i=fe.create(t,e,r);return i.css(s),this.append(i),i}get firstChild(){return fe.create(this.el.firstElementChild)}children(){var t=this.el.firstElementChild;if(!t)return[];var e=[];do{e.push(fe.create(t)),t=t.nextElementSibling}while(t);return e}childLength(){return this.el.children.length}replace(t){return this.el.parentNode&&this.el.parentNode.replaceChild(t.el||t,this.el),this}replaceChild(t,e){return this.el.replaceChild(e.el||e,t.el||t),this}checked(t=!1){return 0==arguments.length?!!this.el.checked:(this.el.checked=!!t,this)}click(){return this.el.click(),this}focus(){return this.el.focus(),this}select(){if("true"===this.attr("contenteditable")){var t=document.createRange();t.selectNodeContents(this.el);var e=window.getSelection();e.removeAllRanges(),e.addRange(t)}else this.el.select();return this}blur(){return this.el.blur(),this}context(t="2d"){return this._initContext||(this._initContext=this.el.getContext(t)),this._initContext}resize({width:t,height:e}){this._initContext=null;var r=this.context(),s=window.devicePixelRatio||1;this.px("width",+t),this.px("height",+e),this.el.width=t*s,this.el.height=e*s,r.scale(s,s)}toDataURL(t="image/png",e=1){return this.el.toDataURL(t,e)}clear(){this.context().clearRect(0,0,this.el.width,this.el.height)}update(t){this.clear(),t.call(this,this)}drawImage(t,e=0,r=0){var s=this.context(),i=window.devicePixelRatio||1;s.drawImage(t,e,r,t.width,t.height,0,0,this.el.width/i,this.el.height/i)}drawOption(t={}){var e=this.context();Object.assign(e,t)}drawLine(t,e,r,s){var i=this.context();i.beginPath(),i.moveTo(t,e),i.lineTo(r,s),i.stroke(),i.closePath()}drawPath(...t){var e=this.context();e.beginPath(),t.forEach((t,r)=>{0==r?e.moveTo(t[0],t[1]):e.lineTo(t[0],t[1])}),e.stroke(),e.fill(),e.closePath()}drawCircle(t,e,r){var s=this.context();s.beginPath(),s.arc(t,e,r,0,2*Math.PI),s.stroke(),s.fill()}drawText(t,e,r){this.context().fillText(r,t,e)}}const ge=()=>!0;function me(t,e=0){if(0===e)return t;var r=void 0;return function(s,i,n,a,l){r&&clearTimeout(r),r=setTimeout(function(){t(s,i,n,a,l)},e||300)}}function ve(t,e){var r=void 0;return function(s,i,n,a,l){r||(r=setTimeout(function(){t(s,i,n,a,l),r=null},e||300))}}function be(t,e){Object.keys(t).forEach((r,s)=>{e(r,t[r],s)})}function ye(t){return!1===function(t){return null==t}(t)}function xe(t){return"string"==typeof t}function Ce(t){return"function"==typeof t}const Ee=/\<(\w*)([^\>]*)\/\>/gim,Te={image:!0,input:!0,br:!0,path:!0,line:!0,circle:!0,rect:!0,path:!0,polygon:!0,polyline:!0,use:!0},ke=(t,...e)=>t.map((t,r)=>{var s=e[r]||"";return Ce(s)&&console.log(s),Array.isArray(s)||(s=[s]),t+s.join("")}).join("").replace(Ee,function(t,e){return Te[e.toLowerCase()]?t:t.replace("/>",`></${e}>`)}),we=(t,e)=>{const r=t.filter(t=>t.indexOf(`${e}(`)>-1),s=r.map(t=>{const[r,s]=t.split(`${e}(`)[1].split(")")[0].trim().split(" ");return{target:r,param:s}});return[r,s]};class Me{constructor(t,e={}){this.context=t,this.options=e}initialize(){}load(){}refresh(){}render(){}getRef(t){return this.context.getRef(t)}run(){}destroy(){}}const Se={touchstart:!0,touchmove:!0,mousedown:!0,mouseup:!0,mousemove:!0},Ne={doubletab:"touchend"},$e={doubletab:!0};class Le extends Me{initialize(){this.destroy(),this._domEvents||(this._domEvents=this.context.filterProps(s)),this._domEvents.forEach(t=>this.parseDomEvent(t))}destroy(){this.removeEventAll()}removeEventAll(){this.getBindings().forEach(t=>{this.removeDomEvent(t)}),this.initBindings()}removeDomEvent({eventName:t,dom:e,callback:r}){le.removeDomEvent(e,t,r)}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){this.getBindings().push(t)}initBindings(){this._bindings=[]}matchPath(t,e){return t?t.matches(e)?t:this.matchPath(t.parentElement,e):null}hasDelegate(t,e){return this.matchPath(t.target||t.srcElement,e.delegate)}makeCallback(t,e){return t.delegate?this.makeDelegateCallback(t,e):this.makeDefaultCallback(t,e)}makeDefaultCallback(t,e){return r=>{var s=this.runEventCallback(r,t,e);if(ye(s))return s}}makeDelegateCallback(t,e){return r=>{const s=this.hasDelegate(r,t);if(s){r.$dt=fe.create(s);var i=this.runEventCallback(r,t,e);if(ye(i))return i}}}runEventCallback(t,e,r){const s=this.context;if(t.xy=le.posXY(t),e.beforeMethods.length&&e.beforeMethods.every(e=>s[e.target].call(s,t,e.param)),this.checkEventType(t,e)){var i=r(t,t.$dt,t.xy);return!1!==i&&e.afterMethods.length&&e.afterMethods.forEach(e=>s[e.target].call(s,t,e.param)),i}}checkEventType(t,e){const r=this.context;var s=!0;e.codes.length&&(s=!!t.code&&e.codes.indexOf(t.code.toLowerCase())>-1||!!t.key&&e.codes.indexOf(t.key.toLowerCase())>-1);var i=!0;return e.checkMethodList.length&&(i=e.checkMethodList.every(e=>{var s=r[e];return Ce(s)&&s?s.call(r,t):!ye(s)||!!s})),s&&i}getDefaultDomElement(t){const e=this.context;let r;return r=t?e.refs[t]||e[t]||window[t]:e.el||e.$el||e.$root,r instanceof fe?r.getElement():r}getRealEventName(t){return Ne[t]||t}getCustomEventName(t){return $e[t]?t:""}getDefaultEventObject(t,e){const r=this.context;let s=e;const i=s.filter(t=>!!r[t]),[n,a]=we(s,"after"),[l,o]=we(s,"before"),[h,c]=we(s,"debounce"),[d,u]=we(s,"delay"),[p,f]=we(s,"throttle"),[g]=we(s,"capture"),m=[].concat(i,n,l,d,h,p,g);var v=s.filter(t=>-1===m.indexOf(t)).map(t=>t.toLowerCase());return{eventName:this.getRealEventName(t),customEventName:this.getCustomEventName(t),codes:v,captures:g,afterMethods:a,beforeMethods:o,delayMethods:u,debounceMethods:c,throttleMethods:f,checkMethodList:i}}addDomEvent(t,e){t.callback=this.makeCallback(t,e),this.addBinding(t);var r=!!t.captures.length;Se[t.eventName]&&(r={passive:!0,capture:r}),le.addDomEvent(t.dom,t.eventName,t.callback,r)}makeCustomEventCallback(t,e){if("doubletab"===t.customEventName){var r=300;return t.delayMethods.length&&(r=+t.delayMethods[0].target),(...t)=>{this.doubleTab?(performance.now()-this.doubleTab.time<r&&e.apply(void 0,t),this.doubleTab=null):this.doubleTab={time:performance.now()}}}return e}bindingDomEvent([t,e,...r],s,i){let n=this.getDefaultEventObject(t,s);n.dom=this.getDefaultDomElement(e),n.delegate=r.join(" "),n.debounceMethods.length?i=me(i,+n.debounceMethods[0].target):n.throttleMethods.length&&(i=ve(i,+n.throttleMethods[0].target)),i=this.makeCustomEventCallback(n,i),this.addDomEvent(n,i)}getEventNames(t){let e=[];return t.split(":").forEach(t=>{var r=t.split(":");e.push.apply(e,r)}),e}parseDomEvent(t){const e=this.context;let r=t.split(h).map(t=>t.trim()).filter(Boolean);var s=r.shift().split("@magic:domevent ")[1].split(" "),i=this.getEventNames(s[0]),n=e[t].bind(e);for(let t=0,e=i.length;t<e;t++)s[0]=i[t],this.bindingDomEvent(s,r,n)}}const _e=(t,e,r)=>{if("cssText"!==e)if("style"!==e)if("class"!==e)"callback"!==e||"function"!=typeof r?void 0===r?t.removeAttr(e):"TEXTAREA"===t.el.nodeName&&"value"===e||"text"===e||"textContent"===e?t.text(r):"innerHTML"===e||"html"===e?t.html(r):"htmlDiff"===e?t.updateDiff(r):"svgDiff"===e?t.updateSVGDiff(r):"value"===e?t.val(r):t.attr(e,r):r();else if(Array.isArray(r))t.addClass.apply(t,r.filter(Boolean));else if(function(t){return"object"==typeof t&&!Array.isArray(t)&&!function(t){return"number"==typeof t}(t)&&!xe(t)&&null!==t}(r)){const e=Object.keys(r);for(var s=0,i=e.length;s<i;s++){const i=e[s];t.toggleClass(i,r[i])}}else t.el.className=r;else"string"!=typeof r&&t.css(r);else t.cssText(r)};class De extends Me{load(...t){this.bindData.apply(this,t)}bindData(...t){var e=this;this._bindMethods||(this._bindMethods=this.context.filterProps(n)),this._bindMethods.filter(e=>{if(!t.length)return!0;var[r,s]=e.split(h),[i,n]=r.split(" ");return t.indexOf(n)>-1}).forEach(async function(r){const s=e.context[r];var[r,i]=r.split(h);const n=e.getRef(i);let a=se;""!=n&&"string"==typeof n?a=re(n):"function"==typeof n&&(a=n);const l=r.split("@magic:bind ")[1];let o=e.context.refs[l];const c="function"==typeof a&&a.call(e.context);if(o&&c){const r=await s.call.apply(s,[e.context].concat(t));if(!r)return;const i=Object.keys(r);for(var d=0,u=i.length;d<u;d++){const t=i[d];_e(o,t,r[t])}}})}destroy(){this._bindMethods=void 0}}const Ae=new Map;function Oe(t={}){Object.keys(t).forEach(e=>{Ae.has(e)||Ae.set(e,t[e])})}const Pe=/[xy]/g;function je(){var t=(new Date).getTime();return"xxx12-xx-34xx".replace(Pe,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})}function Re(){var t=(new Date).getTime();return"idxxxxxxx".replace(Pe,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})}let Be,He,Ie=t=>t;const Ve=fe.create("div");class ze{constructor(t){this.cachedCallback={},this.callbacks={},this.commandes=[],this.editor=t}getCallbacks(t){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t]}setCallbacks(t,e=[]){this.callbacks[t]=e}debug(...t){var e;this.editor&&this.editor.config.get("debug")&&(e=console).debug.apply(e,t)}on(t,e,r,s=0,i=0,n=!1,a=!1,l=[]){var o=e;return s>0?o=me(e,s):i>0&&(o=ve(e,i)),l.length&&(o=function(t,e,r){return(...s)=>{r.every(t=>e[t.target].apply(e,s))&&t.apply(e,s)}}(o,r,l)),this.getCallbacks(t).push({event:t,callback:o,context:r,originalCallback:e,enableAllTrigger:n,enableSelfTrigger:a}),this.debug("add message event",t,r.sourceName),()=>{this.off(t,e)}}off(t,e){this.debug("off message event",t),1==arguments.length?this.setCallbacks(t):2==arguments.length&&this.setCallbacks(t,this.getCallbacks(t).filter(t=>t.originalCallback!==e))}offAll(t){Object.keys(this.callbacks).forEach(e=>{this.setCallbacks(e,this.getCallbacks(e).filter(e=>e.context!==t))}),this.debug("off all message",t.sourceName)}getCachedCallbacks(t){return this.getCallbacks(t)}sendMessage(t,e,...r){Promise.resolve().then(()=>{var s=this.getCachedCallbacks(e);if(s)for(var i=0,n=s.length;i<n;i++){const e=s[i];e.enableSelfTrigger||(e.enableAllTrigger||e.originalCallback.source!==t)&&e.callback.apply(e.context,r)}})}nextSendMessage(t,e,...r){Promise.resolve().then(()=>{e.apply(void 0,r)})}triggerMessage(t,e,...r){Promise.resolve().then(()=>{var s=this.getCachedCallbacks(e);if(s)for(var i=0,n=s.length;i<n;i++){const e=s[i];e.originalCallback.source===t&&e.callback.apply(e.context,r)}else console.warn(e," is not valid event")})}emit(t,...e){Ce(t)?t.apply(void 0,e):this.sendMessage.apply(this,[this.source,t].concat(e))}nextTick(t){this.nextSendMessage(this.source,t)}trigger(t,...e){Ce(t)?t.apply(void 0,e):this.triggerMessage.apply(this,[this.source,t].concat(e))}}class Fe extends class{constructor(t,e){this.state={},this.prevState={},this.refs={},this.children={},this._bindings=[],this.id=je(),this.__tempVariables=new Map,this.handlers=this.initializeHandler(),this.initializeProperty(t,e),this.initComponents()}initializeProperty(t,e={}){this.opt=t||{},this.parent=this.opt,this.props=e,this.source=je(),this.sourceName=this.constructor.name}initComponents(){this.childComponents=this.components()}initializeHandler(){return[new De(this),new Le(this)]}initState(){return{}}setState(t={},e=!0){this.prevState=this.state,this.state=Object.assign({},this.state,t),e&&this.load()}toggleState(t,e=!0){this.setState({[t]:!this.state[t]},e)}variable(t){const e=`__ref__variable:${Re()}`;return this.__tempVariables.set(e,t),e}recoverVariable(t){if(!1===xe(t))return t;let e=t;return this.__tempVariables.has(t)&&(e=this.__tempVariables.get(t),this.__tempVariables.delete(t)),e}_reload(t){this.props=t,this.state={},this.setState(this.initState(),!1),this.refresh(!0)}render(t){this.$el=this.parseTemplate(ke(Be||(Be=Ie`
        ${0}
      `),this.template())),this.refs.$el=this.$el,t&&t.append(this.$el),this.load(),this.afterRender()}initialize(){this.state=this.initState()}afterRender(){}components(){return{}}getRef(...t){const e=t.join("");return this.refs[e]}parseTemplate(t,e){Array.isArray(t)&&(t=t.join("")),t=t.trim();const r=Ve.html(t).children();for(var s=0,i=r.length;s<i;s++){const t=r[s];var n=t.attr("ref");n&&(this.refs[n]=t);for(var a=t.$$("[ref]"),l={},o=0,h=a.length;o<h;o++){const t=a[o],e=t.attr("ref");l[e]?console.warn(`${n} is duplicated. - ${this.sourceName}`,this):l[e]=!0,this.refs[e]=t}}return!e&&r.length?r[0]:fe.create(Ve.createChildrenFragment())}parseProperty(e){let r={};for(var s of e.el.attributes)r[s.nodeName]=this.recoverVariable(s.nodeValue);return r.props&&(r=t({},r,ee(r.props))),e.$$("property").forEach(t=>{const[e,s,i]=t.attrs("name","value","valueType");let n=s||t.text();"json"===i&&(n=JSON.parse(n)),r[e]=n}),r}parseSourceName(t){return t.parent?[t.sourceName].concat(this.parseSourceName(t.parent)):[t.sourceName]}getEventMachineComponent(t){return Ae.get(t)||this.childComponents[t]}parseComponent(){this.$el.$$("[refclass]").forEach(t=>{const e=this.getEventMachineComponent(t.attr("refclass"));if(e){let i=this.parseProperty(t),n=t.attr("ref");var r,s=null;this.children[n]?(s=this.children[n])._reload(i):(s=new e(this,i),this.children[n||s.id]=s,s.render()),s.renderTarget?(null==(r=s.$el)||r.appendTo(s.renderTarget),t.remove()):t.replace(s.$el)}else t.remove()}),be(this.children,(t,e)=>{e&&e.clean()&&delete this.children[t]})}clean(){if(this.$el&&!this.$el.hasParent())return be(this.children,(t,e)=>{e.clean()}),this.destroy(),this.$el=null,!0}refresh(){this.load()}_afterLoad(){this.runHandlers("initialize"),this.bindData(),this.parseComponent()}async load(...t){var e=this;this._loadMethods||(this._loadMethods=this.filterProps(i));const r=this._loadMethods.filter(e=>{const r=e.split("@magic:load ")[1].split(h).map(t=>t.trim())[0];return!t.length||t.indexOf(r)>-1});await r.forEach(async function(r){let s=r.split("@magic:load ")[1];var[i,...n]=s.split(h).map(t=>t.trim());n=n.map(t=>t.trim());const a=Boolean(n.filter(t=>z.includes(t)).length);if(e.refs[i]){var l,o=await(l=e[r]).call.apply(l,[e].concat(t));Array.isArray(o)&&(o=o.join(""));const s=e.parseTemplate(ke(He||(He=Ie`${0}`),o),!0);a?e.refs[i].htmlDiff(s):e.refs[i].html(s)}}),this._afterLoad()}runHandlers(t="run",...e){this.handlers.forEach(r=>r[t].apply(r,e))}bindData(...t){this.runHandlers.apply(this,["load"].concat(t))}template(){return null}eachChildren(t){Ce(t)&&be(this.children,(e,r)=>{t(r)})}rerender(){var t=this.$el.parent();this.destroy(),this.render(t)}destroy(){this.eachChildren(t=>{t.destroy()}),this.runHandlers("destroy"),this.$el&&this.$el.remove(),this.$el=null,this.refs={},this.children={}}collectProps(){return this.__cachedMethodList||(this.__cachedMethodList=function(t,e=ge){let r=t,s=[];do{if(0==r instanceof Object)break;const i=Object.getOwnPropertyNames(r).filter(r=>t&&Ce(t[r])&&e(r));s.push.apply(s,i)}while(r=Object.getPrototypeOf(r));return s}(this,t=>0===t.indexOf("@magic:"))),this.__cachedMethodList}filterProps(t){return this.collectProps().filter(e=>e.match(t))}self(t){return t&&t.$dt&&t.$dt.is(t.target)}isAltKey(t){return t.altKey}isCtrlKey(t){return t.ctrlKey}isShiftKey(t){return t.shiftKey}isMetaKey(t){return t.metaKey||"Meta"==t.key||t.code.indexOf("Meta")>-1}isMouseLeftButton(t){return 1===t.buttons}isMouseRightButton(t){return 2===t.buttons}hasMouse(t){return"mouse"===t.pointerType}hasTouch(t){return"touch"===t.pointerType}hasPen(t){return"pen"===t.pointerType}preventDefault(t){return t.preventDefault(),!0}stopPropagation(t){return t.stopPropagation(),!0}}{constructor(t,e={}){super(t,e),this.__UID=new Set,e.store&&(this.__storeInstance=e.store),this.created(),this.initialize(),this.initializeStoreEvent()}setStore(t){this.__storeInstance=t}get $store(){return this.__storeInstance||this.parent.$store}created(){}getRealEventName(t,e=MULTI_PREFIX){var r=t.indexOf(e);return t.substr(r<0?0:r+e.length)}splitMethod(t,e,r=0){var[s,i]=we(t,e);return[s.length?+i[0].target:r,s,i]}createLocalCallback(t,e){var r=e.bind(this);return r.displayName=`${this.sourceName}.${t}`,r.source=this.source,r}initializeStoreEvent(){this.filterProps(a).forEach(t=>{const e=this.getRealEventName(t,"@magic:subscribe "),[r,...s]=e.split(h),i=s.map(t=>t.trim()).filter(t=>this[t]).map(t=>({target:t})),[n,a]=this.splitMethod(s,"debounce"),[l,o]=this.splitMethod(s,"throttle"),[c,d]=this.splitMethod(s,"allTrigger"),[u,p]=this.splitMethod(s,"selfTrigger");e.split(h).filter(t=>-1===i.indexOf(t)&&-1===a.indexOf(t)&&-1===d.indexOf(t)&&-1===p.indexOf(t)&&-1===o.indexOf(t)).map(t=>t.trim()).filter(Boolean).forEach(e=>{if(Ce(this[t])){var r=this.createLocalCallback(e,this[t]);this.$store.on(e,r,this,n,l,d.length,p.length,i)}})})}destoryStoreSUBSCRIBE(){this.$store.offAll(this)}destroy(){super.destroy(),this.destoryStoreSUBSCRIBE()}rerender(){super.rerender(),this.initialize(),this.initializeStoreEvent()}emit(t,...e){var r;this.$store.source=this.source,this.$store.sourceContext=this,(r=this.$store).emit.apply(r,[t].concat(e))}nextTick(t){this.$store.nextTick(t)}trigger(t,...e){var r;this.$store.source=this.source,(r=this.$store).trigger.apply(r,[t].concat(e))}broadcast(t,...e){Object.keys(this.children).forEach(r=>{var s;(s=this.children[r]).trigger.apply(s,[t].concat(e))})}on(t,e){this.$store.on(t,e)}off(t,e){this.$store.off(t,e)}subscribe(t,e=0,r=0){const s=`subscribe.${Re()}`,i=this.createLocalCallback(s,t);return this.$store.on(s,i,this,e,r,!1,!0),s}}const Ke=(e,r={})=>{const s=fe.create(r.container||document.body),i=new e(r,t({},r,{store:r.store||new ze}));return i.render(s),i};export{y as AFTER,W as ALL_TRIGGER,L as ALT,Wt as ANIMATIONEND,Gt as ANIMATIONITERATION,Ut as ANIMATIONSTART,k as ARROW_DOWN,w as ARROW_LEFT,M as ARROW_RIGHT,T as ARROW_UP,x as BEFORE,ie as BIND,se as BIND_CHECK_DEFAULT_FUNCTION,re as BIND_CHECK_FUNCTION,u as BIND_SAPARATOR,At as BLUR,ze as BaseStore,Y as CAPTURE,Nt as CHANGE,Kt as CHANGEINPUT,b as CHECKER,n as CHECK_BIND_PATTERN,s as CHECK_DOM_EVENT_PATTERN,i as CHECK_LOAD_PATTERN,h as CHECK_SAPARATOR,a as CHECK_SUBSCRIBE_PATTERN,st as CLICK,et as CONFIG,St as CONTEXTMENU,A as CONTROL,rt as CUSTOM,X as D1000,F as DEBOUNCE,K as DELAY,z as DOMDIFF,c as DOM_EVENT_SAPARATOR,it as DOUBLECLICK,Zt as DOUBLETAB,bt as DRAG,Mt as DRAGEND,Et as DRAGENTER,kt as DRAGEXIT,Tt as DRAGLEAVE,wt as DRAGOUT,Ct as DRAGOVER,yt as DRAGSTART,xt as DROP,fe as Dom,S as ENTER,$ as ESCAPE,I as FIT,Lt as FOCUS,_t as FOCUSIN,Dt as FOCUSOUT,C as IF,$t as INPUT,E as KEY,gt as KEYDOWN,vt as KEYPRESS,mt as KEYUP,B as LEFT_BUTTON,te as LOAD,d as LOAD_SAPARATOR,e as MAGIC_METHOD,D as META,O as MOUSE,nt as MOUSEDOWN,ct as MOUSEENTER,dt as MOUSELEAVE,lt as MOUSEMOVE,ht as MOUSEOUT,ot as MOUSEOVER,at as MOUSEUP,o as NAME_SAPARATOR,V as PASSIVE,Ot as PASTE,j as PEN,l as PIPE,Ft as POINTEREND,It as POINTERENTER,zt as POINTERMOVE,Vt as POINTEROUT,Ht as POINTEROVER,Bt as POINTERSTART,q as PREVENT,Pt as RESIZE,H as RIGHT_BUTTON,f as SAPARATOR,jt as SCROLL,R as SELF,G as SELF_TRIGGER,_ as SHIFT,N as SPACE,J as STOP,Rt as SUBMIT,Q as SUBSCRIBE,Z as SUBSCRIBE_ALL,p as SUBSCRIBE_SAPARATOR,tt as SUBSCRIBE_SELF,U as THROTTLE,P as TOUCH,ft as TOUCHEND,pt as TOUCHMOVE,ut as TOUCHSTART,Qt as TRANSITIONCANCEL,qt as TRANSITIONEND,Jt as TRANSITIONRUN,Yt as TRANSITIONSTART,Fe as UIElement,Xt as WHEEL,ee as getRef,r as makeEventChecker,ne as normalizeWheelEvent,Oe as registElement,Ke as start};
//# sourceMappingURL=sapa.modern.js.map
