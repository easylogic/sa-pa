const t="@magic:",e=(t,e=a)=>` ${e} ${t}`,n=/domevent (.*)/gi,i=/load (.*)/gi,r=/bind (.*)/gi,o=/subscribe (.*)/gi,l=(...t)=>t.join("|"),s=":",a="|",u="@magic:domevent ",c="@magic:load ",h="@magic:bind ",f="@magic:subscribe ",d=" ",v={},p=(...t)=>{var e=t.join(":");return(...t)=>"@magic:domevent "+[e].concat(t).join(" ")},y=(...t)=>"@magic:subscribe "+t.join(a),m=(t,n=a)=>e(t,n),g=(t,n=a)=>e(`after(${t})`,n),k=(t,n=a)=>e(`before(${t})`,n),b=m,E=m,C=m("ArrowUp"),x=m("ArrowDown"),w=m("ArrowLeft"),M=m("ArrowRight"),T=m("Enter"),_=m("Space"),$=m("Escape"),S=m("isAltKey"),O=m("isShiftKey"),N=m("isMetaKey"),L=m("isCtrlKey"),D=m("hasMouse"),A=m("hasTouch"),j=m("hasPen"),P=m("self"),R=m("isMouseLeftButton"),B=m("isMouseRightButton"),H=m("fit"),V=m("passive"),z=m("domdiff"),F=(t=100)=>m(`debounce(${t})`),K=(t=300)=>m(`delay(${t})`),I=F(1e3),X=(t=100)=>m(`throttle(${t})`),W=m("allTrigger()"),G=m("selfTrigger()"),U=m("capture()"),Y=g("preventDefault"),q=g("stopPropagation"),J=y,Q=(...t)=>y.apply(void 0,t.concat([W])),Z=(...t)=>y.apply(void 0,t.concat([G])),tt=(t,...e)=>y.apply(void 0,[`config:${t}`].concat(e)),et=p,nt=p("click"),it=p("dblclick"),rt=p("mousedown"),ot=p("mouseup"),lt=p("mousemove"),st=p("mouseover"),at=p("mouseout"),ut=p("mouseenter"),ct=p("mouseleave"),ht=p("touchstart"),ft=p("touchmove"),dt=p("touchend"),vt=p("keydown"),pt=p("keyup"),yt=p("keypress"),mt=p("drag"),gt=p("dragstart"),kt=p("drop"),bt=p("dragover"),Et=p("dragenter"),Ct=p("dragleave"),xt=p("dragexit"),wt=p("dragout"),Mt=p("dragend"),Tt=p("contextmenu"),_t=p("change"),$t=p("input"),St=p("focus"),Ot=p("focusin"),Nt=p("focusout"),Lt=p("blur"),Dt=p("paste"),At=p("resize"),jt=p("scroll"),Pt=p("submit"),Rt=(...t)=>et("pointerdown").apply(void 0,t)+R,Bt=et("pointerover"),Ht=et("pointerenter"),Vt=et("pointerout"),zt=et("pointermove"),Ft=et("pointerup"),Kt=et("change","input"),It=et("wheel","mousewheel","DOMMouseScroll"),Xt=p("animationstart"),Wt=p("animationend"),Gt=p("animationiteration"),Ut=p("transitionstart"),Yt=p("transitionend"),qt=p("transitionrun"),Jt=p("transitioncancel"),Qt=et("doubletab"),Zt=(t="$el")=>"@magic:load "+t,te=t=>v[t]||"",ee=t=>function(){return this.prevState[t]!=this.state[t]},ne=()=>!0,ie=(t="$el")=>"@magic:bind "+t;function re(t){let e=t.deltaX,n=t.deltaY;return 0===e&&t.shiftKey&&([n,e]=[e,n]),t.deltaMode===WheelEvent.DOM_DELTA_LINE?n*=8:t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(n*=24),[oe(e,24),oe(n,24),0]}function oe(t,e){return Math.sign(t)*Math.min(e,Math.abs(t))}var le={addDomEvent(t,e,n,i=!1){t&&t.addEventListener(e,n,i)},removeDomEvent(t,e,n){t&&t.removeEventListener(e,n)},pos:t=>t.touches&&t.touches[0]?t.touches[0]:t,posXY(t){var e=this.pos(t);return{x:e.pageX,y:e.pageY}}};const se=new Map;function ae(t={}){Object.keys(t).forEach(e=>{se.has(e)||se.set(e,t[e])})}function ue(t){return se.get(t)}function ce(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function he(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function fe(t,e,n){return e&&he(t.prototype,e),n&&he(t,n),t}function de(){return(de=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function ve(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ye(t,e)}function pe(t){return(pe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ye(t,e){return(ye=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function me(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ge(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,i=pe(t);if(e){var r=pe(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return me(this,n)}}function ke(t,e,n){return(ke="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=pe(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}const be=()=>!0;function Ee(t,e=0){if(0===e)return t;var n=void 0;return function(...i){n&&clearTimeout(n),n=setTimeout(function(){t.apply(void 0,i)},e||300)}}function Ce(t,e){var n=void 0;return function(...i){n||(n=setTimeout(function(){t.apply(void 0,i),n=null},e||300))}}function xe(t,e){Object.keys(t).forEach((n,i)=>{e(n,t[n],i)})}function we(t){return!1===function(t){return null==t}(t)}function Me(t){return"string"==typeof t}function Te(t){return"function"==typeof t}const _e=/\<(\w*)([^\>]*)\/\>/gim,$e={image:!0,input:!0,br:!0,path:!0,line:!0,circle:!0,rect:!0,polygon:!0,polyline:!0,use:!0},Se=(t,...e)=>t.map((t,n)=>{var i=e[n]||"";return Te(i)&&console.log(i),Array.isArray(i)||(i=[i]),t+i.join("")}).join("").replace(_e,function(t,e){return $e[e.toLowerCase()]?t:t.replace("/>",`></${e}>`)}),Oe=(t,e)=>{const n=t.filter(t=>t.indexOf(`${e}(`)>-1),i=n.map(t=>{const[n,i]=t.split(`${e}(`)[1].split(")")[0].trim().split(" ");return{target:n,param:i}});return[n,i]};let Ne=function(){function t(e){ce(this,t),this.cachedCallback=void 0,this.callbacks=void 0,this.editor=void 0,this.source=void 0,this.cachedCallback={},this.callbacks={},this.editor=e}return fe(t,[{key:"getCallbacks",value:function(t){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t]}},{key:"setCallbacks",value:function(t,e=[]){this.callbacks[t]=e}},{key:"on",value:function(t,e,n,i=0,r=0,o=!1,l=!1,s=[]){var a=e;return i>0?a=Ee(e,i):r>0&&(a=Ce(e,r)),s.length&&(a=function(t,e,n){return(...i)=>{n.every(t=>e[t.target].apply(e,i))&&t.apply(e,i)}}(a,n,s)),this.getCallbacks(t).push({event:t,callback:a,context:n,originalCallback:e,enableAllTrigger:o,enableSelfTrigger:l}),this.debug("add message event",t,n.sourceName),()=>{this.off(t,e)}}},{key:"debug",value:function(t,e,n){throw new Error("Method not implemented.")}},{key:"off",value:function(t,e){this.debug("off message event",t),1==arguments.length?this.setCallbacks(t):2==arguments.length&&this.setCallbacks(t,this.getCallbacks(t).filter(t=>t.originalCallback!==e))}},{key:"offAll",value:function(t){Object.keys(this.callbacks).forEach(e=>{this.setCallbacks(e,this.getCallbacks(e).filter(e=>e.context!==t))}),this.debug("off all message",t.sourceName)}},{key:"getCachedCallbacks",value:function(t){return this.getCallbacks(t)}},{key:"sendMessage",value:function(t,e,...n){Promise.resolve().then(()=>{var i=this.getCachedCallbacks(e);if(i)for(var r=0,o=i.length;r<o;r++){const e=i[r];e.enableSelfTrigger||(e.enableAllTrigger||e.originalCallback.source!==t)&&e.callback.apply(e.context,n)}})}},{key:"nextSendMessage",value:function(t,e,...n){Promise.resolve().then(()=>{e.apply(void 0,n)})}},{key:"triggerMessage",value:function(t,e,...n){Promise.resolve().then(()=>{var i=this.getCachedCallbacks(e);if(i)for(var r=0,o=i.length;r<o;r++){const e=i[r];e.originalCallback.source===t&&e.callback.apply(e.context,n)}else console.warn(e," is not valid event")})}},{key:"emit",value:function(t,...e){Te(t)?t.apply(void 0,e):this.sendMessage.apply(this,[this.source,t].concat(e))}},{key:"nextTick",value:function(t){this.nextSendMessage(this.source,t)}},{key:"trigger",value:function(t,...e){Te(t)?t.apply(void 0,e):this.triggerMessage.apply(this,[this.source,t].concat(e))}}]),t}();const Le=(t,e,n,i)=>{n?i&&n===i||((t,e,n)=>{"boolean"==typeof n?((t,e,n)=>{n?(t.setAttribute(e,e),t[e]=n):(t.removeAttribute(e),t[e]=n)})(t,e,n):t.setAttribute(e,n)})(t,e,n):((t,e,n)=>{"boolean"==typeof n?((t,e)=>{t.removeAttribute(e),t[e]=!1})(t,e):e&&((t,e)=>{t.removeAttribute(e)})(t,e)})(t,e,i)};function De(t){return t.nodeType!==Node.TEXT_NODE&&"true"===t.getAttribute("data-domdiff-pass")}function Ae(t){var e={};const n=t.length;for(let i=0;i<n;i++){const n=t[i];e[n.name]=n.value}return e}function je(t,e,n,i){if(e)if(n){if(De(e)||De(n));else if(a=e,(s=n).nodeType===Node.TEXT_NODE&&s.textContent!==a.textContent||s.nodeName!==a.nodeName||function(t){return t.nodeType!==Node.TEXT_NODE&&t.getAttribute("refClass")}(n))t.replaceChild(n.cloneNode(!0),e);else if(n.nodeType!==Node.TEXT_NODE&&n.nodeType!==Node.COMMENT_NODE&&"[object HTMLUnknownElement]"!==n.toString()){((t,e={},n={})=>{const i=[];i.push.apply(i,Object.keys(e)),i.push.apply(i,Object.keys(n));const r=[].concat(new Set(i));for(var o=0,l=r.length;o<l;o++){const i=r[o];Le(t,i,e[i],n[i])}})(e,Ae(n.attributes),Ae(e.attributes));var r=Pe(e),o=Pe(n),l=Math.max(r.length,o.length);for(i=0;i<l;i++)je(e,r[i],o[i],i)}}else t.removeChild(e);else t.appendChild(n.cloneNode(!0));var s,a}const Pe=t=>{var e=t.firstChild;if(!e)return[];var n=[];do{n.push(e),e=e.nextSibling}while(e);return n};function Re(t,e){e=e.el||e;for(var n=Pe(t=t.el||t),i=Pe(e),r=Math.max(n.length,i.length),o=0;o<r;o++)je(t,n[o],i[o],o)}let Be=function(){function t(e,n="",i={}){if(ce(this,t),this.el=void 0,this._initContext=void 0,"string"!=typeof e)this.el=e;else{var r=document.createElement(e);for(var o in n&&(r.className=n),i)r.setAttribute(o,i[o]);this.el=r}}return fe(t,[{key:"htmlEl",get:function(){return this.el}},{key:"inputEl",get:function(){return this.el}},{key:"svgEl",get:function(){return this.el}},{key:"setAttr",value:function(t){return Object.keys(t).forEach(e=>{this.attr(e,t[e])}),this}},{key:"setAttrNS",value:function(t,e="http://www.w3.org/2000/svg"){return Object.keys(t).forEach(n=>{this.attrNS(n,t[n],e)}),this}},{key:"setProp",value:function(t){return Object.keys(t).forEach(e=>{this.htmlEl[e]!=t[e]&&(this.htmlEl[e]=t[e])}),this}},{key:"data",value:function(t,e){return 1===arguments.length?this.attr("data-"+t):2===arguments.length?this.attr("data-"+t,e):this}},{key:"attr",value:function(t,e){return 1==arguments.length?this.htmlEl.getAttribute(t):(this.htmlEl.getAttribute(t)!=e&&this.htmlEl.setAttribute(t,`${e}`),this)}},{key:"attrNS",value:function(t,e,n="http://www.w3.org/2000/svg"){return 1==arguments.length?this.svgEl.getAttributeNS(n,t):(this.svgEl.getAttributeNS(n,t)!=e&&this.svgEl.setAttributeNS(n,t,e),this)}},{key:"attrKeyValue",value:function(t){return{[`${this.htmlEl.getAttribute(t)}`]:this.val()}}},{key:"attrs",value:function(...t){return t.map(t=>this.htmlEl.getAttribute(t))}},{key:"styles",value:function(...t){return t.map(t=>this.htmlEl.style[t])}},{key:"removeAttr",value:function(t){return this.htmlEl.removeAttribute(t),this}},{key:"removeStyle",value:function(t){return this.htmlEl.style.removeProperty(t),this}},{key:"is",value:function(t){return this.htmlEl===(t.el||t)}},{key:"isTag",value:function(t){return this.htmlEl.tagName.toLowerCase()===t.toLowerCase()}},{key:"closest",value:function(e){for(var n=this,i=!1;!(i=n.hasClass(e));){if(!n.el.parentNode)return null;n=t.create(n.el.parentNode)}return i?n:null}},{key:"path",value:function(){if(!this.htmlEl)return[];const t=this.parent();return t?[].concat(t.path(),[this]):[this]}},{key:"parent",value:function(){return t.create(this.htmlEl.parentNode)}},{key:"hasParent",value:function(){return!!this.htmlEl.parentNode}},{key:"removeClass",value:function(...t){var e;return(e=this.htmlEl.classList).remove.apply(e,t),this}},{key:"hasClass",value:function(t){return!!this.htmlEl.classList&&this.htmlEl.classList.contains(t)}},{key:"addClass",value:function(...t){var e;return(e=this.htmlEl.classList).add.apply(e,t),this}},{key:"onlyOneClass",value:function(t){this.parent().children().forEach(e=>{e.removeClass(t)}),this.addClass(t)}},{key:"toggleClass",value:function(t,e){return this.htmlEl.classList.toggle(t,e),this}},{key:"html",value:function(t){return void 0===t?this.htmlEl.innerHTML:("string"==typeof t?this.htmlEl.innerHTML=t:this.empty().append(t),this)}},{key:"htmlDiff",value:function(t){Re(this,t)}},{key:"updateDiff",value:function(e,n="div"){Re(this,t.create(n).html(e))}},{key:"updateSVGDiff",value:function(e,n="div"){Re(this,t.create(n).html(`<svg>${e}</svg>`).firstChild.firstChild)}},{key:"find",value:function(t){return this.htmlEl.querySelector(t)}},{key:"$",value:function(e){var n=this.find(e);return n?t.create(n):null}},{key:"findAll",value:function(t){return Array.from(this.htmlEl.querySelectorAll(t))}},{key:"$$",value:function(e){return this.findAll(e).map(e=>t.create(e))}},{key:"empty",value:function(){for(;this.htmlEl.firstChild;)this.htmlEl.removeChild(this.htmlEl.firstChild);return this}},{key:"append",value:function(t){return this.htmlEl.appendChild("string"==typeof t?document.createTextNode(t):t.el||t),this}},{key:"prepend",value:function(t){return this.htmlEl.prepend("string"==typeof t?document.createTextNode(t):t.el||t),this}},{key:"prependHTML",value:function(e){var n=t.create("div").html(e);return this.prepend(n.createChildrenFragment()),n}},{key:"appendHTML",value:function(e){var n=t.create("div").html(e);return this.append(n.createChildrenFragment()),n}},{key:"createChildrenFragment",value:function(){const t=this.children();var e=document.createDocumentFragment();return t.forEach(t=>e.appendChild(t.el)),e}},{key:"appendTo",value:function(t){return(t.el?t.el:t).appendChild(this.htmlEl),this}},{key:"remove",value:function(){return this.htmlEl.parentNode&&this.htmlEl.parentNode.removeChild(this.htmlEl),this}},{key:"removeChild",value:function(t){return this.htmlEl.removeChild(t.el||t),this}},{key:"text",value:function(e){if(void 0===e)return this.htmlEl.textContent;var n=e;return e instanceof t&&(n=e.text()),this.htmlEl.textContent!==n&&(this.htmlEl.textContent=n),this}},{key:"css",value:function(t,e){const n=this.htmlEl;if("string"==typeof t&&void 0!==e)0===t.indexOf("--")&&void 0!==e?n.style.setProperty(t,e):n.style[t]=e;else if(void 0!==t){if("string"==typeof t)return getComputedStyle(n)[t];Object.entries(t).forEach(([t,e])=>{0===t.indexOf("--")&&void 0!==e?n.style.setProperty(t,e):n.style[t]=e})}return this}},{key:"getComputedStyle",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(...t){var e=getComputedStyle(this.htmlEl),n={};return t.forEach(t=>{n[t]=e[t]}),n})},{key:"getStyleList",value:function(...t){const e=this.htmlEl;for(var n={},i=e.style.length,r=0;r<i;r++){var o=e.style[r];n[o]=e.style[o]}return t.forEach(t=>{n[t]=this.css(t)}),n}},{key:"cssText",value:function(t){return void 0===t?this.htmlEl.style.cssText:this}},{key:"cssFloat",value:function(t){return parseFloat(this.css(t))}},{key:"cssInt",value:function(t){return parseInt(this.css(t))}},{key:"px",value:function(t,e){return this.css(t,`${e}px`)}},{key:"rect",value:function(){return this.htmlEl.getBoundingClientRect()}},{key:"bbox",value:function(){return this.el.getBBox()}},{key:"isSVG",value:function(){return"SVG"===this.htmlEl.tagName.toUpperCase()}},{key:"offsetRect",value:function(){const t=this.htmlEl;if(this.isSVG()){const t=this.parent().rect(),e=this.rect();return{x:e.x-t.x,y:e.y-t.y,top:e.x-t.x,left:e.y-t.y,width:e.width,height:e.height}}return{x:t.offsetLeft,y:t.offsetTop,top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}},{key:"offset",value:function(){var e=this.rect(),n=t.getScrollTop(),i=t.getScrollLeft();return{top:e.top+n,left:e.left+i}}},{key:"offsetLeft",value:function(){return this.offset().left}},{key:"offsetTop",value:function(){return this.offset().top}},{key:"position",value:function(){return this.htmlEl.style.top?{top:parseFloat(this.css("top")),left:parseFloat(this.css("left"))}:this.rect()}},{key:"size",value:function(){return[this.width(),this.height()]}},{key:"width",value:function(){return this.htmlEl.offsetWidth||this.rect().width}},{key:"contentWidth",value:function(){return this.width()-this.cssFloat("padding-left")-this.cssFloat("padding-right")}},{key:"height",value:function(){return this.htmlEl.offsetHeight||this.rect().height}},{key:"contentHeight",value:function(){return this.height()-this.cssFloat("padding-top")-this.cssFloat("padding-bottom")}},{key:"val",value:function(e){if(void 0===e)return this.inputEl.value;if(void 0!==e){var n=e;e instanceof t?n=e.val():this.inputEl.value=n}return this}},{key:"matches",value:function(t){return this.htmlEl&&this.htmlEl.matches?this.htmlEl.matches(t)?this:this.parent().matches(t):null}},{key:"value",get:function(){return this.inputEl.value}},{key:"files",get:function(){return this.inputEl.files?Array.from(this.inputEl.files):[]}},{key:"show",value:function(t="block"){return this.htmlEl.style.display="none"!=t?t:"block",this}},{key:"hide",value:function(){return this.htmlEl.style.display="none",this}},{key:"isHide",value:function(){return"none"===this.htmlEl.style.display}},{key:"isShow",value:function(){return!this.isHide()}},{key:"toggle",value:function(t){var e=this.isHide();return 1==arguments.length?t?this.show():this.hide():e?this.show():this.hide()}},{key:"scrollIntoView",value:function(){this.htmlEl.scrollIntoView()}},{key:"addScrollLeft",value:function(t){return this.htmlEl.scrollLeft+=t,this}},{key:"addScrollTop",value:function(t){return this.htmlEl.scrollTop+=t,this}},{key:"setScrollTop",value:function(t){return this.htmlEl.scrollTop=t,this}},{key:"setScrollLeft",value:function(t){return this.htmlEl.scrollLeft=t,this}},{key:"scrollTop",value:function(){return this.htmlEl===document.body?t.getScrollTop():this.htmlEl.scrollTop}},{key:"scrollLeft",value:function(){return this.htmlEl===document.body?t.getScrollLeft():this.htmlEl.scrollLeft}},{key:"scrollHeight",value:function(){return this.htmlEl.scrollHeight}},{key:"scrollWidth",value:function(){return this.htmlEl.scrollWidth}},{key:"on",value:function(t,e,n){return this.htmlEl.addEventListener(t,e,n),this}},{key:"off",value:function(t,e){return this.htmlEl.removeEventListener(t,e),this}},{key:"getElement",value:function(){return this.htmlEl}},{key:"createChild",value:function(e,n="",i={},r={}){let o=t.create(e,n,i);return o.css(r),this.append(o),o}},{key:"firstChild",get:function(){return t.create(this.htmlEl.firstElementChild)}},{key:"children",value:function(){var e=this.htmlEl.firstElementChild;if(!e)return[];var n=[];do{n.push(t.create(e)),e=e.nextElementSibling}while(e);return n}},{key:"childLength",value:function(){return this.htmlEl.children.length}},{key:"replace",value:function(t){return this.htmlEl.parentNode&&this.htmlEl.parentNode.replaceChild(t.el||t,this.htmlEl),this}},{key:"replaceChild",value:function(t,e){return this.htmlEl.replaceChild(e.el||e,t.el||t),this}},{key:"checked",value:function(t=!1){return 0==arguments.length?!!this.inputEl.checked:(this.inputEl.checked=!!t,this)}},{key:"click",value:function(){return this.htmlEl.click(),this}},{key:"focus",value:function(){return this.htmlEl.focus(),this}},{key:"select",value:function(){if("true"===this.attr("contenteditable")){var t=document.createRange();t.selectNodeContents(this.htmlEl);var e=window.getSelection();null==e||e.removeAllRanges(),null==e||e.addRange(t)}else this.inputEl.select();return this}},{key:"blur",value:function(){return this.htmlEl.blur(),this}}],[{key:"create",value:function(e,n="",i={}){return new t(e,n,i)}},{key:"createByHTML",value:function(e){var n=t.create("div").html(e).children();return n.length?t.create(n[0].el):null}},{key:"getScrollTop",value:function(){return Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)}},{key:"getScrollLeft",value:function(){return Math.max(window.pageXOffset,document.documentElement.scrollLeft,document.body.scrollLeft)}},{key:"parse",value:function(t){return(new DOMParser).parseFromString(t,"text/html")}},{key:"body",value:function(){return t.create(document.body)}}]),t}(),He=function(){function t(e,n={}){ce(this,t),this.context=void 0,this.options=void 0,this.context=e,this.options=n}return fe(t,[{key:"initialize",value:function(){}},{key:"load",value:function(){}},{key:"refresh",value:function(){}},{key:"render",value:function(){}},{key:"getRef",value:function(t){return this.context.getRef(t)}},{key:"run",value:function(){}},{key:"destroy",value:function(){}}]),t}();const Ve={touchstart:!0,touchmove:!0,mousedown:!0,mouseup:!0,mousemove:!0},ze={doubletab:"touchend"},Fe={doubletab:!0};let Ke=function(t){ve(i,He);var e=ge(i);function i(...t){var n;return ce(this,i),(n=e.call.apply(e,[this].concat(t)))._domEvents=void 0,n._bindings=void 0,n.doubleTab=void 0,n}return fe(i,[{key:"initialize",value:function(){this.destroy(),this._domEvents||(this._domEvents=this.context.filterProps(n)),this._domEvents.forEach(t=>this.parseDomEvent(t))}},{key:"destroy",value:function(){this.removeEventAll()}},{key:"removeEventAll",value:function(){var t;null==(t=this.getBindings())||t.forEach(t=>{this.removeDomEvent(t)}),this.initBindings()}},{key:"removeDomEvent",value:function({eventName:t,dom:e,callback:n}){e&&le.removeDomEvent(e,t,n)}},{key:"getBindings",value:function(){return this._bindings||this.initBindings(),this._bindings}},{key:"addBinding",value:function(t){var e;null==(e=this.getBindings())||e.push(t)}},{key:"initBindings",value:function(){this._bindings=[]}},{key:"matchPath",value:function(t,e){return t?t.matches(e)?t:this.matchPath(t.parentElement,e):null}},{key:"hasDelegate",value:function(t,e){return this.matchPath(t.target||t.srcElement,e.delegate)}},{key:"makeCallback",value:function(t,e){return t.delegate?this.makeDelegateCallback(t,e):this.makeDefaultCallback(t,e)}},{key:"makeDefaultCallback",value:function(t,e){return n=>{var i=this.runEventCallback(n,t,e);if(we(i))return i}}},{key:"makeDelegateCallback",value:function(t,e){return n=>{const i=this.hasDelegate(n,t);if(i){n.$dt=Be.create(i);var r=this.runEventCallback(n,t,e);if(we(r))return r}}}},{key:"runEventCallback",value:function(t,e,n){const i=this.context;if(t.xy=le.posXY(t),e.beforeMethods.length&&e.beforeMethods.every(e=>i[e.target].call(i,t,e.param)),this.checkEventType(t,e)){var r=n(t,t.$dt,t.xy);return!1!==r&&e.afterMethods.length&&e.afterMethods.forEach(e=>i[e.target].call(i,t,e.param)),r}}},{key:"checkEventType",value:function(t,e){const n=this.context;var i=!0;e.codes.length&&(i=!!t.code&&e.codes.indexOf(t.code.toLowerCase())>-1||!!t.key&&e.codes.indexOf(t.key.toLowerCase())>-1);var r=!0;return e.checkMethodList.length&&(r=e.checkMethodList.every(e=>{var i=n[e];return Te(i)&&i?i.call(n,t):!we(i)||!!i})),i&&r}},{key:"getDefaultDomElement",value:function(t){const e=this.context;let n;return n="string"==typeof t&&t?e.refs[t]||e[t]||window[t]:e.el||e.$el||e.$root,n instanceof Be?n.getElement():n}},{key:"getRealEventName",value:function(t){return ze[t]||t}},{key:"getCustomEventName",value:function(t){return Fe[t]?t:""}},{key:"getDefaultEventObject",value:function(t,e){const n=this.context;let i=e;const r=i.filter(t=>!!n[t]),[o,l]=Oe(i,"after"),[s,a]=Oe(i,"before"),[u,c]=Oe(i,"debounce"),[h,f]=Oe(i,"delay"),[d,v]=Oe(i,"throttle"),[p]=Oe(i,"capture"),y=[].concat(r,o,s,h,u,d,p);var m=i.filter(t=>-1===y.indexOf(t)).map(t=>t.toLowerCase());return{eventName:this.getRealEventName(t),customEventName:this.getCustomEventName(t),codes:m,captures:p,afterMethods:l,beforeMethods:a,delayMethods:f,debounceMethods:c,throttleMethods:v,checkMethodList:r}}},{key:"addDomEvent",value:function(t,e){t.callback=this.makeCallback(t,e),this.addBinding(t);var n=!!t.captures.length;Ve[t.eventName]&&(n={passive:!0,capture:n}),null!=t&&t.dom&&le.addDomEvent(null==t?void 0:t.dom,t.eventName,t.callback,n)}},{key:"makeCustomEventCallback",value:function(t,e){if("doubletab"===t.customEventName){var n=300;return t.delayMethods.length&&(n=+t.delayMethods[0].target),(...t)=>{this.doubleTab?(performance.now()-this.doubleTab.time<n&&e.apply(void 0,t),this.doubleTab=null):this.doubleTab={time:performance.now()}}}return e}},{key:"bindingDomEvent",value:function([t,e,...n],i,r){let o=this.getDefaultEventObject(t,i);o.dom=this.getDefaultDomElement(e),o.delegate=n.join(" "),o.debounceMethods.length?r=Ee(r,+o.debounceMethods[0].target):o.throttleMethods.length&&(r=Ce(r,+o.throttleMethods[0].target)),r=this.makeCustomEventCallback(o,r),this.addDomEvent(o,r)}},{key:"getEventNames",value:function(t){let e=[];return t.split(":").forEach(t=>{var n=t.split(":");e.push.apply(e,n)}),e}},{key:"parseDomEvent",value:function(t){const e=this.context;let n=t.split(a).map(t=>t.trim()).filter(Boolean);var i=n.shift(),r=null==i?void 0:i.split("@magic:domevent ")[1],o=null==r?void 0:r.split(" ");if(o){var l=this.getEventNames(o[0]),s=e[t].bind(e);for(let t=0,e=l.length;t<e;t++)o[0]=l[t],this.bindingDomEvent(o,n,s)}}}]),i}();const Ie=(t,e,n)=>{if("cssText"!==e)if("style"!==e)if("class"!==e)"callback"!==e||"function"!=typeof n?void 0===n?t.removeAttr(e):"TEXTAREA"===t.el.nodeName&&"value"===e||"text"===e||"textContent"===e?t.text(n):"innerHTML"===e||"html"===e?t.html(n):"htmlDiff"===e?t.updateDiff(n):"svgDiff"===e?t.updateSVGDiff(n):"value"===e?t.val(n):t.attr(e,n):n();else if(Array.isArray(n))t.addClass.apply(t,null==n?void 0:n.filter(Boolean));else if(function(t){return"object"==typeof t&&!Array.isArray(t)&&!function(t){return"number"==typeof t}(t)&&!Me(t)&&null!==t}(n)){const e=Object.keys(n);for(var i=0,r=e.length;i<r;i++){const r=e[i];t.toggleClass(r,n[r])}}else t.htmlEl.className=n;else"string"!=typeof n&&t.css(n);else t.cssText(n)};let Xe=function(t){ve(n,He);var e=ge(n);function n(...t){var i;return ce(this,n),(i=e.call.apply(e,[this].concat(t)))._bindMethods=void 0,i}return fe(n,[{key:"load",value:function(...t){this.bindData.apply(this,t)}},{key:"bindData",value:function(...t){var e;this._bindMethods||(this._bindMethods=this.context.filterProps(r));const n=null==(e=this._bindMethods)?void 0:e.filter(e=>{if(!t.length)return!0;var[n,i]=e.split(a),[r,o]=n.split(" ");return t.indexOf(o)>-1});null==n||n.forEach(async e=>{const n=this.context[e];var[e,i]=e.split(a);const r=this.getRef(i);let o=ne;"string"==typeof r&&""!==r?o=ee(r):"function"==typeof r&&(o=r);const l=e.split("@magic:bind ")[1];let s=this.context.refs[l];const u="function"==typeof o&&o.call(this.context);if(s&&u){const e=await n.call.apply(n,[this.context].concat(t));if(!e)return;const i=Object.keys(e);for(var c=0,h=i.length;c<h;c++){const t=i[c];Ie(s,t,e[t])}}})}},{key:"destroy",value:function(){this._bindMethods=void 0}}]),n}();const We=/[xy]/g;function Ge(){var t=(new Date).getTime();return"xxx12-xx-34xx".replace(We,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)})}function Ue(){var t=(new Date).getTime();return"idxxxxxxx".replace(We,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)})}let Ye,qe,Je=t=>t;const Qe=Be.create("div");let Ze=function(){function t(e,n){ce(this,t),this.state=void 0,this.prevState=void 0,this.children=void 0,this._bindings=void 0,this.id=void 0,this.__tempVariables=void 0,this.handlers=void 0,this._loadMethods=void 0,this.__cachedMethodList=void 0,this._$store=void 0,this.el=void 0,this.$el=void 0,this.$root=void 0,this.refs=void 0,this.opt=void 0,this.parent=void 0,this.props=void 0,this.source=void 0,this.sourceName=void 0,this.childComponents=void 0,this.state={},this.prevState={},this.refs={},this.children={},this._bindings=[],this.id=Ge(),this.__tempVariables=new Map,this.handlers=this.initializeHandler(),this.initializeProperty(e,n),this.initComponents()}return fe(t,[{key:"$store",get:function(){return this._$store},set:function(t){this._$store=t}},{key:"initializeProperty",value:function(t,e={}){this.opt=t||{},this.parent=this.opt,this.props=e,this.source=Ge(),this.sourceName=this.constructor.name}},{key:"initComponents",value:function(){this.childComponents=this.components()}},{key:"initializeHandler",value:function(){return[new Xe(this),new Ke(this)]}},{key:"initState",value:function(){return{}}},{key:"setState",value:function(t={},e=!0){this.prevState=this.state,this.state=Object.assign({},this.state,t),e&&this.load()}},{key:"toggleState",value:function(t,e=!0){this.setState({[t]:!this.state[t]},e)}},{key:"variable",value:function(t){const e=`__ref__variable:${Ue()}`;return this.__tempVariables.set(e,t),e}},{key:"recoverVariable",value:function(t){if(!1===Me(t))return t;let e=t;return this.__tempVariables.has(t)&&(e=this.__tempVariables.get(t),this.__tempVariables.delete(t)),e}},{key:"_reload",value:function(t){this.props=t,this.state={},this.setState(this.initState(),!1),this.refresh()}},{key:"render",value:function(t){this.$el=this.parseTemplate(Se(Ye||(Ye=Je`
        ${0}
      `),this.template())),this.refs.$el=this.$el,t&&t.append(this.$el),this.load(),this.afterRender()}},{key:"initialize",value:function(){this.state=this.initState()}},{key:"afterRender",value:function(){}},{key:"components",value:function(){return{}}},{key:"getRef",value:function(...t){const e=t.join("");return this.refs[e]}},{key:"parseTemplate",value:function(t,e=!1){Array.isArray(t)&&(t=t.join("")),t=t.trim();const n=Qe.html(t).children();for(var i=0,r=n.length;i<r;i++){const t=n[i];var o=t.attr("ref");o&&(this.refs[o]=t);for(var l=t.$$("[ref]"),s={},a=0,u=l.length;a<u;a++){const t=l[a],e=t.attr("ref");s[e]?console.warn(`${o} is duplicated. - ${this.sourceName}`,this):s[e]=!0,this.refs[e]=t}}return!e&&n.length?n[0]:Be.create(Qe.createChildrenFragment())}},{key:"parseProperty",value:function(t){let e={};for(var n of t.htmlEl.attributes)e[n.nodeName]=this.recoverVariable(n.nodeValue);return e.props&&(e=de({},e,te(e.props))),t.$$("property").forEach(t=>{const[n,i,r]=t.attrs("name","value","valueType");let o=i||t.text();"json"===r&&(o=JSON.parse(o)),e[n]=o}),e}},{key:"getEventMachineComponent",value:function(t){return ue(t)||this.childComponents[t]}},{key:"parseComponent",value:function(){this.$el.$$("[refclass]").forEach(t=>{const e=this.getEventMachineComponent(t.attr("refclass"));if(e){let r=this.parseProperty(t),o=t.attr("ref");var n,i=null;this.children[o]?(i=this.children[o])._reload(r):(i=new e(this,r),this.children[o||i.id]=i,i.render()),i.renderTarget?(null==(n=i.$el)||n.appendTo(i.renderTarget),t.remove()):t.replace(i.$el)}else t.remove()}),xe(this.children,(t,e)=>{e&&e.clean()&&delete this.children[t]})}},{key:"clean",value:function(){if(this.$el&&!this.$el.hasParent())return xe(this.children,(t,e)=>{e.clean()}),this.destroy(),this.$el=null,!0}},{key:"refresh",value:function(){this.load()}},{key:"_afterLoad",value:function(){this.runHandlers("initialize"),this.bindData(),this.parseComponent()}},{key:"load",value:async function(...t){this._loadMethods||(this._loadMethods=this.filterProps(i));const e=this._loadMethods.filter(e=>{const n=e.split("@magic:load ")[1].split(a).map(t=>t.trim())[0];return!t.length||t.indexOf(n)>-1});await e.forEach(async e=>{let n=e.split("@magic:load ")[1];var[i,...r]=n.split(a).map(t=>t.trim());r=r.map(t=>t.trim());const o=Boolean(r.filter(t=>z.includes(t)).length);if(this.refs[i]){var l,s=await(l=this[e]).call.apply(l,[this].concat(t));Array.isArray(s)&&(s=s.join(""));const n=this.parseTemplate(Se(qe||(qe=Je`${0}`),s),!0);o?this.refs[i].htmlDiff(n):this.refs[i].html(n)}}),this._afterLoad()}},{key:"runHandlers",value:function(t="run",...e){this.handlers.forEach(n=>n[t].apply(n,e))}},{key:"bindData",value:function(...t){this.runHandlers.apply(this,["load"].concat(t))}},{key:"template",value:function(){return null}},{key:"eachChildren",value:function(t){Te(t)&&xe(this.children,(e,n)=>{t(n)})}},{key:"rerender",value:function(){var t=this.$el.parent();this.destroy(),this.render(t)}},{key:"destroy",value:function(){this.eachChildren(t=>{t.destroy()}),this.runHandlers("destroy"),this.$el&&this.$el.remove(),this.$el=null,this.refs={},this.children={}}},{key:"collectProps",value:function(){return this.__cachedMethodList||(this.__cachedMethodList=function(t,e=be){let n=t,i=[];do{if(0==n instanceof Object)break;const r=Object.getOwnPropertyNames(n).filter(n=>t&&Te(t[n])&&e(n));i.push.apply(i,r)}while(n=Object.getPrototypeOf(n));return i}(this,t=>0===t.indexOf("@magic:"))),this.__cachedMethodList}},{key:"filterProps",value:function(t){return this.collectProps().filter(e=>e.match(t))}},{key:"self",value:function(t){return t&&t.$dt&&t.$dt.is(t.target)}},{key:"isAltKey",value:function(t){return t.altKey}},{key:"isCtrlKey",value:function(t){return t.ctrlKey}},{key:"isShiftKey",value:function(t){return t.shiftKey}},{key:"isMetaKey",value:function(t){return t.metaKey||"Meta"==t.key||t.code.indexOf("Meta")>-1}},{key:"isMouseLeftButton",value:function(t){return 1===t.buttons}},{key:"isMouseRightButton",value:function(t){return 2===t.buttons}},{key:"hasMouse",value:function(t){return"mouse"===t.pointerType}},{key:"hasTouch",value:function(t){return"touch"===t.pointerType}},{key:"hasPen",value:function(t){return"pen"===t.pointerType}},{key:"preventDefault",value:function(t){return t.preventDefault(),!0}},{key:"stopPropagation",value:function(t){return t.stopPropagation(),!0}}]),t}(),tn=function(t){ve(n,Ze);var e=ge(n);function n(t,i){var r;return ce(this,n),(r=e.call(this,t,i)).__storeInstance=void 0,i.store&&(r.__storeInstance=i.store),r.created(),r.initialize(),r.initializeStoreEvent(),r}return fe(n,[{key:"setStore",value:function(t){this.__storeInstance=t}},{key:"$store",get:function(){return this.__storeInstance||this.parent.$store}},{key:"created",value:function(){}},{key:"getRealEventName",value:function(t,e){var n=t.indexOf(e);return t.substr(n<0?0:n+e.length)}},{key:"splitMethod",value:function(t,e,n=0){var[i,r]=Oe(t,e);return[i.length?+r[0].target:n,i,r]}},{key:"createLocalCallback",value:function(t,e){var n=e.bind(this);return n.displayName=`${this.sourceName}.${t}`,n.source=this.source,n}},{key:"initializeStoreEvent",value:function(){this.filterProps(o).forEach(t=>{const e=this.getRealEventName(t,"@magic:subscribe "),[n,...i]=e.split(a),r=i.map(t=>t.trim()).filter(t=>this[t]).map(t=>({target:t})),[o,l]=this.splitMethod(i,"debounce"),[s,u]=this.splitMethod(i,"throttle"),[c,h]=this.splitMethod(i,"allTrigger"),[f,d]=this.splitMethod(i,"selfTrigger");e.split(a).filter(t=>-1===l.indexOf(t)&&-1===h.indexOf(t)&&-1===d.indexOf(t)&&-1===u.indexOf(t)).map(t=>t.trim()).filter(Boolean).forEach(e=>{if(Te(this[t])){var n=this.createLocalCallback(e,this[t]);this.$store.on(e,n,this,o,s,h.length,d.length,r)}})})}},{key:"destoryStoreSUBSCRIBE",value:function(){this.$store.offAll(this)}},{key:"destroy",value:function(){ke(pe(n.prototype),"destroy",this).call(this),this.destoryStoreSUBSCRIBE()}},{key:"rerender",value:function(){ke(pe(n.prototype),"rerender",this).call(this),this.initialize(),this.initializeStoreEvent()}},{key:"emit",value:function(t,...e){var n;this.$store.source=this.source,this.$store.sourceContext=this,(n=this.$store).emit.apply(n,[t].concat(e))}},{key:"nextTick",value:function(t){this.$store.nextTick(t)}},{key:"trigger",value:function(t,...e){var n;this.$store.source=this.source,(n=this.$store).trigger.apply(n,[t].concat(e))}},{key:"broadcast",value:function(t,...e){Object.keys(this.children).forEach(n=>{var i;(i=this.children[n]).trigger.apply(i,[t].concat(e))})}},{key:"on",value:function(t,e){this.$store.on(t,e)}},{key:"off",value:function(t,e){this.$store.off(t,e)}},{key:"subscribe",value:function(t,e=0,n=0){const i=`subscribe.${Ue()}`,r=this.createLocalCallback(i,t);return this.$store.on(i,r,this,e,n,!1,!0),i}}]),n}();const en=(t,e={})=>{const n=Be.create((null==e?void 0:e.container)||document.body),i=new t(e,de({},e,{store:e.store||new Ne}));return i.render(n),i};export{g as AFTER,W as ALL_TRIGGER,S as ALT,Wt as ANIMATIONEND,Gt as ANIMATIONITERATION,Xt as ANIMATIONSTART,x as ARROW_DOWN,w as ARROW_LEFT,M as ARROW_RIGHT,C as ARROW_UP,k as BEFORE,ie as BIND,ne as BIND_CHECK_DEFAULT_FUNCTION,ee as BIND_CHECK_FUNCTION,h as BIND_SAPARATOR,Lt as BLUR,Ne as BaseStore,U as CAPTURE,_t as CHANGE,Kt as CHANGEINPUT,m as CHECKER,r as CHECK_BIND_PATTERN,n as CHECK_DOM_EVENT_PATTERN,i as CHECK_LOAD_PATTERN,a as CHECK_SAPARATOR,o as CHECK_SUBSCRIBE_PATTERN,nt as CLICK,tt as CONFIG,Tt as CONTEXTMENU,L as CONTROL,et as CUSTOM,I as D1000,F as DEBOUNCE,K as DELAY,z as DOMDIFF,u as DOM_EVENT_SAPARATOR,it as DOUBLECLICK,Qt as DOUBLETAB,mt as DRAG,Mt as DRAGEND,Et as DRAGENTER,xt as DRAGEXIT,Ct as DRAGLEAVE,wt as DRAGOUT,bt as DRAGOVER,gt as DRAGSTART,kt as DROP,Be as Dom,T as ENTER,$ as ESCAPE,H as FIT,St as FOCUS,Ot as FOCUSIN,Nt as FOCUSOUT,b as IF,$t as INPUT,E as KEY,vt as KEYDOWN,yt as KEYPRESS,pt as KEYUP,R as LEFT_BUTTON,Zt as LOAD,c as LOAD_SAPARATOR,t as MAGIC_METHOD,N as META,D as MOUSE,rt as MOUSEDOWN,ut as MOUSEENTER,ct as MOUSELEAVE,lt as MOUSEMOVE,at as MOUSEOUT,st as MOUSEOVER,ot as MOUSEUP,s as NAME_SAPARATOR,V as PASSIVE,Dt as PASTE,j as PEN,l as PIPE,Ft as POINTEREND,Ht as POINTERENTER,zt as POINTERMOVE,Vt as POINTEROUT,Bt as POINTEROVER,Rt as POINTERSTART,Y as PREVENT,At as RESIZE,B as RIGHT_BUTTON,d as SAPARATOR,jt as SCROLL,P as SELF,G as SELF_TRIGGER,O as SHIFT,_ as SPACE,q as STOP,Pt as SUBMIT,J as SUBSCRIBE,Q as SUBSCRIBE_ALL,f as SUBSCRIBE_SAPARATOR,Z as SUBSCRIBE_SELF,X as THROTTLE,A as TOUCH,dt as TOUCHEND,ft as TOUCHMOVE,ht as TOUCHSTART,Jt as TRANSITIONCANCEL,Yt as TRANSITIONEND,qt as TRANSITIONRUN,Ut as TRANSITIONSTART,tn as UIElement,It as WHEEL,te as getRef,e as makeEventChecker,re as normalizeWheelEvent,ae as registElement,ue as retriveElement,en as start};
//# sourceMappingURL=sapa.modern.js.map
