function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t}).apply(this,arguments)}const e=(t,e=a)=>` ${e} ${t}`,r=/domevent (.*)/gi,s=/load (.*)/gi,i=/bind (.*)/gi,n=/subscribe (.*)/gi,a="|",l={},o=(...t)=>{var e=t.join(":");return(...t)=>"@magic:domevent "+[e].concat(t).join(" ")},h=(...t)=>"@magic:subscribe "+t.join(a),c=(t,r=a)=>e(t,r),d=(t,r=a)=>e(`after(${t})`,r),u=c,p=c,f=c("ArrowUp"),g=c("ArrowDown"),m=c("ArrowLeft"),v=c("ArrowRight"),E=c("Enter"),b=c("Space"),y=c("Escape"),T=c("isAltKey"),C=c("isShiftKey"),A=c("isMetaKey"),O=c("isCtrlKey"),N=c("hasMouse"),x=c("hasTouch"),S=c("hasPen"),R=c("self"),M=c("isMouseLeftButton"),_=c("isMouseRightButton"),k=c("fit"),D=c("passive"),w=c("domdiff"),L=(t=100)=>c(`debounce(${t})`),P=L(1e3),I=c("allTrigger()"),$=c("selfTrigger()"),U=c("capture()"),B=d("preventDefault"),H=d("stopPropagation"),F=h,j=o,V=o("click"),K=o("dblclick"),G=o("mousedown"),W=o("mouseup"),z=o("mousemove"),X=o("mouseover"),Y=o("mouseout"),q=o("mouseenter"),J=o("mouseleave"),Z=o("touchstart"),Q=o("touchmove"),tt=o("touchend"),et=o("keydown"),rt=o("keyup"),st=o("keypress"),it=o("drag"),nt=o("dragstart"),at=o("drop"),lt=o("dragover"),ot=o("dragenter"),ht=o("dragleave"),ct=o("dragexit"),dt=o("dragout"),ut=o("dragend"),pt=o("contextmenu"),ft=o("change"),gt=o("input"),mt=o("focus"),vt=o("focusin"),Et=o("focusout"),bt=o("blur"),yt=o("paste"),Tt=o("resize"),Ct=o("scroll"),At=o("submit"),Ot=j("pointerover"),Nt=j("pointerenter"),xt=j("pointerout"),St=j("pointermove"),Rt=j("pointerup"),Mt=j("change","input"),_t=j("wheel","mousewheel","DOMMouseScroll"),kt=o("animationstart"),Dt=o("animationend"),wt=o("animationiteration"),Lt=o("transitionstart"),Pt=o("transitionend"),It=o("transitionrun"),$t=o("transitioncancel"),Ut=j("doubletab"),Bt=t=>l[t]||"",Ht=t=>function(){return this.prevState[t]!=this.state[t]},Ft=()=>!0;function jt(t,e){return Math.sign(t)*Math.min(e,Math.abs(t))}var Vt={addDomEvent(t,e,r,s=!1){t&&t.addEventListener(e,r,s)},removeDomEvent(t,e,r){t&&t.removeEventListener(e,r)},pos:t=>t.touches&&t.touches[0]?t.touches[0]:t,posXY(t){var e=this.pos(t);return{x:e.pageX,y:e.pageY}}},Kt={__proto__:null,MAGIC_METHOD:"@magic:",makeEventChecker:e,CHECK_DOM_EVENT_PATTERN:r,CHECK_LOAD_PATTERN:s,CHECK_BIND_PATTERN:i,CHECK_SUBSCRIBE_PATTERN:n,PIPE:(...t)=>t.join("|"),NAME_SAPARATOR:":",CHECK_SAPARATOR:a,DOM_EVENT_SAPARATOR:"@magic:domevent ",LOAD_SAPARATOR:"@magic:load ",BIND_SAPARATOR:"@magic:bind ",SUBSCRIBE_SAPARATOR:"@magic:subscribe ",SAPARATOR:" ",CHECKER:c,AFTER:d,BEFORE:(t,r=a)=>e(`before(${t})`,r),IF:u,KEY:p,ARROW_UP:f,ARROW_DOWN:g,ARROW_LEFT:m,ARROW_RIGHT:v,ENTER:E,SPACE:b,ESCAPE:y,ALT:T,SHIFT:C,META:A,CONTROL:O,MOUSE:N,TOUCH:x,PEN:S,SELF:R,LEFT_BUTTON:M,RIGHT_BUTTON:_,FIT:k,PASSIVE:D,DOMDIFF:w,DEBOUNCE:L,DELAY:(t=300)=>c(`delay(${t})`),D1000:P,THROTTLE:(t=100)=>c(`throttle(${t})`),ALL_TRIGGER:I,SELF_TRIGGER:$,CAPTURE:U,PREVENT:B,STOP:H,SUBSCRIBE:F,SUBSCRIBE_ALL:(...t)=>h.apply(void 0,t.concat([I])),SUBSCRIBE_SELF:(...t)=>h.apply(void 0,t.concat([$])),CONFIG:(t,...e)=>h.apply(void 0,[`config:${t}`].concat(e)),CUSTOM:j,CLICK:V,DOUBLECLICK:K,MOUSEDOWN:G,MOUSEUP:W,MOUSEMOVE:z,MOUSEOVER:X,MOUSEOUT:Y,MOUSEENTER:q,MOUSELEAVE:J,TOUCHSTART:Z,TOUCHMOVE:Q,TOUCHEND:tt,KEYDOWN:et,KEYUP:rt,KEYPRESS:st,DRAG:it,DRAGSTART:nt,DROP:at,DRAGOVER:lt,DRAGENTER:ot,DRAGLEAVE:ht,DRAGEXIT:ct,DRAGOUT:dt,DRAGEND:ut,CONTEXTMENU:pt,CHANGE:ft,INPUT:gt,FOCUS:mt,FOCUSIN:vt,FOCUSOUT:Et,BLUR:bt,PASTE:yt,RESIZE:Tt,SCROLL:Ct,SUBMIT:At,POINTERSTART:(...t)=>j("pointerdown").apply(void 0,t)+M,POINTEROVER:Ot,POINTERENTER:Nt,POINTEROUT:xt,POINTERMOVE:St,POINTEREND:Rt,CHANGEINPUT:Mt,WHEEL:_t,ANIMATIONSTART:kt,ANIMATIONEND:Dt,ANIMATIONITERATION:wt,TRANSITIONSTART:Lt,TRANSITIONEND:Pt,TRANSITIONRUN:It,TRANSITIONCANCEL:$t,DOUBLETAB:Ut,LOAD:(t="$el")=>"@magic:load "+t,getRef:Bt,BIND_CHECK_FUNCTION:Ht,BIND_CHECK_DEFAULT_FUNCTION:Ft,BIND:(t="$el")=>"@magic:bind "+t,normalizeWheelEvent:function(t){let e=t.deltaX,r=t.deltaY;return 0===e&&t.shiftKey&&([r,e]=[e,r]),t.deltaMode===WheelEvent.DOM_DELTA_LINE?r*=8:t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(r*=24),[jt(e,24),jt(r,24),0]},default:Vt};const Gt=(t,e,r,s)=>{r?s&&r===s||((t,e,r)=>{"boolean"==typeof r?((t,e,r)=>{r?(t.setAttribute(e,e),t[e]=r):(t.removeAttribute(e),t[e]=r)})(t,e,r):t.setAttribute(e,r)})(t,e,r):((t,e,r)=>{"boolean"==typeof r?((t,e)=>{t.removeAttribute(e),t[e]=!1})(t,e):e&&((t,e)=>{t.removeAttribute(e)})(t,e)})(t,e,s)};function Wt(t){return t.nodeType!==Node.TEXT_NODE&&"true"===t.getAttribute("data-domdiff-pass")}function zt(t){var e={};const r=t.length;for(let s=0;s<r;s++){const r=t[s];e[r.name]=r.value}return e}function Xt(t,e,r,s){if(e)if(r){if(Wt(e)||Wt(r));else if(o=e,(l=r).nodeType===Node.TEXT_NODE&&l.textContent!==o.textContent||l.nodeName!==o.nodeName||function(t){return t.nodeType!==Node.TEXT_NODE&&t.getAttribute("refClass")}(r))t.replaceChild(r.cloneNode(!0),e);else if(r.nodeType!==Node.TEXT_NODE&&r.nodeType!==Node.COMMENT_NODE&&"[object HTMLUnknownElement]"!==r.toString()){((t,e={},r={})=>{const s=[];s.push.apply(s,Object.keys(e)),s.push.apply(s,Object.keys(r));const i=[].concat(new Set(s));for(var n=0,a=i.length;n<a;n++){const s=i[n];Gt(t,s,e[s],r[s])}})(e,zt(r.attributes),zt(e.attributes));var i=Yt(e),n=Yt(r),a=Math.max(i.length,n.length);for(s=0;s<a;s++)Xt(e,i[s],n[s],s)}}else t.removeChild(e);else t.appendChild(r.cloneNode(!0));var l,o}const Yt=t=>{var e=t.firstChild;if(!e)return[];var r=[];do{r.push(e),e=e.nextSibling}while(e);return r};function qt(t,e){e=e.el||e;for(var r=Yt(t=t.el||t),s=Yt(e),i=Math.max(r.length,s.length),n=0;n<i;n++)Xt(t,r[n],s[n],n)}class Jt{constructor(t,e,r){if("string"!=typeof t)this.el=t;else{var s=document.createElement(t);for(var i in e&&(s.className=e),r=r||{})s.setAttribute(i,r[i]);this.el=s}}static create(t,e,r){return new Jt(t,e,r)}static createByHTML(t){var e=Jt.create("div").html(t).children();return e.length?Jt.create(e[0].el):null}static getScrollTop(){return Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)}static getScrollLeft(){return Math.max(window.pageXOffset,document.documentElement.scrollLeft,document.body.scrollLeft)}static parse(t){return DOMParser().parseFromString(t,"text/htmll")}static body(){return Jt.create(document.body)}setAttr(t){return Object.keys(t).forEach(e=>{this.attr(e,t[e])}),this}setAttrNS(t,e="http://www.w3.org/2000/svg"){return Object.keys(t).forEach(r=>{this.attr(r,t[r],e)}),this}setProp(t){return Object.keys(t).forEach(e=>{this.el[e]!=t[e]&&(this.el[e]=t[e])}),this}data(t,e){return 1===arguments.length?this.attr("data-"+t):2===arguments.length?this.attr("data-"+t,e):this}attr(t,e){return 1==arguments.length?this.el.getAttribute(t):(this.el.getAttribute(t)!=e&&this.el.setAttribute(t,e),this)}attrNS(t,e,r="http://www.w3.org/2000/svg"){return 1==arguments.length?this.el.getAttributeNS(r,t):(this.el.getAttributeNS(r,t)!=e&&this.el.setAttributeNS(r,t,e),this)}attrKeyValue(t){return{[this.el.getAttribute(t)]:this.val()}}attrs(...t){return t.map(t=>this.el.getAttribute(t))}styles(...t){return t.map(t=>this.el.style[t])}removeAttr(t){return this.el.removeAttribute(t),this}removeStyle(t){return this.el.style.removeProperty(t),this}is(t){return this.el===(t.el||t)}isTag(t){return this.el.tagName.toLowerCase()===t.toLowerCase()}closest(t){for(var e=this,r=!1;!(r=e.hasClass(t));){if(!e.el.parentNode)return null;e=Jt.create(e.el.parentNode)}return r?e:null}path(){if(!this.el)return[];const t=this.parent();return t?[].concat(t.path(),[this]):[this]}parent(){return Jt.create(this.el.parentNode)}hasParent(){return!!this.el.parentNode}removeClass(...t){var e;return(e=this.el.classList).remove.apply(e,t),this}hasClass(t){return!!this.el.classList&&this.el.classList.contains(t)}addClass(...t){var e;return(e=this.el.classList).add.apply(e,t),this}onlyOneClass(t){this.parent().children().forEach(e=>{e.removeClass(t)}),this.addClass(t)}toggleClass(t,e){return this.el.classList.toggle(t,e),this}html(t){return void 0===t?this.el.innerHTML:("string"==typeof t?this.el.innerHTML=t:this.empty().append(t),this)}htmlDiff(t){qt(this,t)}updateDiff(t,e="div"){qt(this,Jt.create(e).html(t))}updateSVGDiff(t,e="div"){qt(this,Jt.create(e).html(`<svg>${t}</svg>`).firstChild.firstChild)}find(t){return this.el.querySelector(t)}$(t){var e=this.find(t);return e?Jt.create(e):null}findAll(t){return Array.from(this.el.querySelectorAll(t))}$$(t){return this.findAll(t).map(t=>Jt.create(t))}empty(){for(;this.el.firstChild;)this.el.removeChild(this.el.firstChild);return this}append(t){return this.el.appendChild("string"==typeof t?document.createTextNode(t):t.el||t),this}prepend(t){return this.el.prepend("string"==typeof t?document.createTextNode(t):t.el||t),this}prependHTML(t){var e=Jt.create("div").html(t);return this.prepend(e.createChildrenFragment()),e}appendHTML(t){var e=Jt.create("div").html(t);return this.append(e.createChildrenFragment()),e}createChildrenFragment(){const t=this.children();var e=document.createDocumentFragment();return t.forEach(t=>e.appendChild(t.el)),e}appendTo(t){return(t.el?t.el:t).appendChild(this.el),this}remove(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this}removeChild(t){return this.el.removeChild(t.el||t),this}text(t){if(void 0===t)return this.el.textContent;var e=t;return t instanceof Jt&&(e=t.text()),this.el.textContent!==e&&(this.el.textContent=e),this}css(t,e){if(void 0!==t&&void 0!==e)0===t.indexOf("--")&&void 0!==e?this.el.style.setProperty(t,e):this.el.style[t]=e;else if(void 0!==t){if("string"==typeof t)return getComputedStyle(this.el)[t];Object.entries(t).forEach(([t,e])=>{0===t.indexOf("--")&&void 0!==e?this.el.style.setProperty(t,e):this.el.style[t]=e})}return this}getComputedStyle(...t){var e=getComputedStyle(this.el),r={};return t.forEach(t=>{r[t]=e[t]}),r}getStyleList(...t){for(var e={},r=this.el.style.length,s=0;s<r;s++){var i=this.el.style[s];e[i]=this.el.style[i]}return t.forEach(t=>{e[t]=this.css(t)}),e}cssText(t){return void 0===t?this.el.style.cssText:(t!=this.el.tempCssText&&(this.el.style.cssText=t,this.el.tempCssText=t),this)}cssArray(t){return t[0]&&(this.el.style[t[0]]=t[1]),t[2]&&(this.el.style[t[2]]=t[3]),t[4]&&(this.el.style[t[4]]=t[5]),t[6]&&(this.el.style[t[6]]=t[7]),t[8]&&(this.el.style[t[8]]=t[9]),this}cssFloat(t){return parseFloat(this.css(t))}cssInt(t){return parseInt(this.css(t))}px(t,e){return this.css(t,`${e}px`)}rect(){return this.el.getBoundingClientRect()}bbox(){return this.el.getBBox()}isSVG(){return"SVG"===this.el.tagName.toUpperCase()}offsetRect(){if(this.isSVG()){const t=this.parent().rect(),e=this.rect();return{x:e.x-t.x,y:e.y-t.y,top:e.x-t.x,left:e.y-t.y,width:e.width,height:e.height}}return{x:this.el.offsetLeft,y:this.el.offsetTop,top:this.el.offsetTop,left:this.el.offsetLeft,width:this.el.offsetWidth,height:this.el.offsetHeight}}offset(){var t=this.rect(),e=Jt.getScrollTop(),r=Jt.getScrollLeft();return{top:t.top+e,left:t.left+r}}offsetLeft(){return this.offset().left}offsetTop(){return this.offset().top}position(){return this.el.style.top?{top:parseFloat(this.css("top")),left:parseFloat(this.css("left"))}:this.rect()}size(){return[this.width(),this.height()]}width(){return this.el.offsetWidth||this.rect().width}contentWidth(){return this.width()-this.cssFloat("padding-left")-this.cssFloat("padding-right")}height(){return this.el.offsetHeight||this.rect().height}contentHeight(){return this.height()-this.cssFloat("padding-top")-this.cssFloat("padding-bottom")}val(t){if(void 0===t)return this.el.value;if(void 0!==t){var e=t;t instanceof Jt&&(e=t.val()),this.el.value=e}return this}matches(t){return this.el&&this.el.matches?this.el.matches(t)?this:this.parent().matches(t):null}get value(){return this.el.value}get naturalWidth(){return this.el.naturalWidth}get naturalHeight(){return this.el.naturalHeight}get files(){return this.el.files?[].concat(this.el.files):[]}realVal(){switch(this.el.nodeType){case"INPUT":var t=this.attr("type");if("checkbox"==t||"radio"==t)return this.checked();case"SELECT":case"TEXTAREA":return this.el.value}return""}int(){return parseInt(this.val(),10)}float(){return parseFloat(this.val())}show(t="block"){return this.el.style.display="none"!=t?t:"block",this}hide(){return this.el.style.display="none",this}isHide(){return"none"===this.el.style.display}isShow(){return!this.isHide()}toggle(t){var e=this.isHide();return 1==arguments.length?t?this.show():this.hide():e?this.show():this.hide()}get totalLength(){return this.el.getTotalLength()}scrollIntoView(){this.el.scrollIntoView()}addScrollLeft(t){return this.el.scrollLeft+=t,this}addScrollTop(t){return this.el.scrollTop+=t,this}setScrollTop(t){return this.el.scrollTop=t,this}setScrollLeft(t){return this.el.scrollLeft=t,this}scrollTop(){return this.el===document.body?Jt.getScrollTop():this.el.scrollTop}scrollLeft(){return this.el===document.body?Jt.getScrollLeft():this.el.scrollLeft}scrollHeight(){return this.el.scrollHeight}scrollWidth(){return this.el.scrollWidth}on(t,e,r,s){return this.el.addEventListener(t,e,r,s),this}off(t,e){return this.el.removeEventListener(t,e),this}getElement(){return this.el}createChild(t,e="",r={},s={}){let i=Jt.create(t,e,r);return i.css(s),this.append(i),i}get firstChild(){return Jt.create(this.el.firstElementChild)}children(){var t=this.el.firstElementChild;if(!t)return[];var e=[];do{e.push(Jt.create(t)),t=t.nextElementSibling}while(t);return e}childLength(){return this.el.children.length}replace(t){return this.el.parentNode&&this.el.parentNode.replaceChild(t.el||t,this.el),this}replaceChild(t,e){return this.el.replaceChild(e.el||e,t.el||t),this}checked(t=!1){return 0==arguments.length?!!this.el.checked:(this.el.checked=!!t,this)}click(){return this.el.click(),this}focus(){return this.el.focus(),this}select(){if("true"===this.attr("contenteditable")){var t=document.createRange();t.selectNodeContents(this.el);var e=window.getSelection();e.removeAllRanges(),e.addRange(t)}else this.el.select();return this}blur(){return this.el.blur(),this}context(t="2d"){return this._initContext||(this._initContext=this.el.getContext(t)),this._initContext}resize({width:t,height:e}){this._initContext=null;var r=this.context(),s=window.devicePixelRatio||1;this.px("width",+t),this.px("height",+e),this.el.width=t*s,this.el.height=e*s,r.scale(s,s)}toDataURL(t="image/png",e=1){return this.el.toDataURL(t,e)}clear(){this.context().clearRect(0,0,this.el.width,this.el.height)}update(t){this.clear(),t.call(this,this)}drawImage(t,e=0,r=0){var s=this.context(),i=window.devicePixelRatio||1;s.drawImage(t,e,r,t.width,t.height,0,0,this.el.width/i,this.el.height/i)}drawOption(t={}){var e=this.context();Object.assign(e,t)}drawLine(t,e,r,s){var i=this.context();i.beginPath(),i.moveTo(t,e),i.lineTo(r,s),i.stroke(),i.closePath()}drawPath(...t){var e=this.context();e.beginPath(),t.forEach((t,r)=>{0==r?e.moveTo(t[0],t[1]):e.lineTo(t[0],t[1])}),e.stroke(),e.fill(),e.closePath()}drawCircle(t,e,r){var s=this.context();s.beginPath(),s.arc(t,e,r,0,2*Math.PI),s.stroke(),s.fill()}drawText(t,e,r){this.context().fillText(r,t,e)}}const Zt=()=>!0;function Qt(t,e=0){if(0===e)return t;var r=void 0;return function(s,i,n,a,l){r&&clearTimeout(r),r=setTimeout(function(){t(s,i,n,a,l)},e||300)}}function te(t,e){var r=void 0;return function(s,i,n,a,l){r||(r=setTimeout(function(){t(s,i,n,a,l),r=null},e||300))}}function ee(t,e){Object.keys(t).forEach((r,s)=>{e(r,t[r],s)})}function re(t){return!1===function(t){return null==t}(t)}function se(t){return"string"==typeof t}function ie(t){return"function"==typeof t}const ne=/\<(\w*)([^\>]*)\/\>/gim,ae={image:!0,input:!0,br:!0,path:!0,line:!0,circle:!0,rect:!0,path:!0,polygon:!0,polyline:!0,use:!0},le=(t,...e)=>t.map((t,r)=>{var s=e[r]||"";return ie(s)&&console.log(s),Array.isArray(s)||(s=[s]),t+s.join("")}).join("").replace(ne,function(t,e){return ae[e.toLowerCase()]?t:t.replace("/>",`></${e}>`)}),oe=(t,e)=>{const r=t.filter(t=>t.indexOf(`${e}(`)>-1),s=r.map(t=>{const[r,s]=t.split(`${e}(`)[1].split(")")[0].trim().split(" ");return{target:r,param:s}});return[r,s]};class he{constructor(t,e={}){this.context=t,this.options=e}initialize(){}load(){}refresh(){}render(){}getRef(t){return this.context.getRef(t)}run(){}destroy(){}}const ce={touchstart:!0,touchmove:!0,mousedown:!0,mouseup:!0,mousemove:!0},de={doubletab:"touchend"},ue={doubletab:!0};class pe extends he{initialize(){this.destroy(),this._domEvents||(this._domEvents=this.context.filterProps(r)),this._domEvents.forEach(t=>this.parseDomEvent(t))}destroy(){this.removeEventAll()}removeEventAll(){this.getBindings().forEach(t=>{this.removeDomEvent(t)}),this.initBindings()}removeDomEvent({eventName:t,dom:e,callback:r}){Vt.removeDomEvent(e,t,r)}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){this.getBindings().push(t)}initBindings(){this._bindings=[]}matchPath(t,e){return t?t.matches(e)?t:this.matchPath(t.parentElement,e):null}hasDelegate(t,e){return this.matchPath(t.target||t.srcElement,e.delegate)}makeCallback(t,e){return t.delegate?this.makeDelegateCallback(t,e):this.makeDefaultCallback(t,e)}makeDefaultCallback(t,e){return r=>{var s=this.runEventCallback(r,t,e);if(re(s))return s}}makeDelegateCallback(t,e){return r=>{const s=this.hasDelegate(r,t);if(s){r.$dt=Jt.create(s);var i=this.runEventCallback(r,t,e);if(re(i))return i}}}runEventCallback(t,e,r){const s=this.context;if(t.xy=Vt.posXY(t),e.beforeMethods.length&&e.beforeMethods.every(e=>s[e.target].call(s,t,e.param)),this.checkEventType(t,e)){var i=r(t,t.$dt,t.xy);return!1!==i&&e.afterMethods.length&&e.afterMethods.forEach(e=>s[e.target].call(s,t,e.param)),i}}checkEventType(t,e){const r=this.context;var s=!0;e.codes.length&&(s=!!t.code&&e.codes.indexOf(t.code.toLowerCase())>-1||!!t.key&&e.codes.indexOf(t.key.toLowerCase())>-1);var i=!0;return e.checkMethodList.length&&(i=e.checkMethodList.every(e=>{var s=r[e];return ie(s)&&s?s.call(r,t):!re(s)||!!s})),s&&i}getDefaultDomElement(t){const e=this.context;let r;return r=t?e.refs[t]||e[t]||window[t]:e.el||e.$el||e.$root,r instanceof Jt?r.getElement():r}getRealEventName(t){return de[t]||t}getCustomEventName(t){return ue[t]?t:""}getDefaultEventObject(t,e){const r=this.context;let s=e;const i=s.filter(t=>!!r[t]),[n,a]=oe(s,"after"),[l,o]=oe(s,"before"),[h,c]=oe(s,"debounce"),[d,u]=oe(s,"delay"),[p,f]=oe(s,"throttle"),[g]=oe(s,"capture"),m=[].concat(i,n,l,d,h,p,g);var v=s.filter(t=>-1===m.indexOf(t)).map(t=>t.toLowerCase());return{eventName:this.getRealEventName(t),customEventName:this.getCustomEventName(t),codes:v,captures:g,afterMethods:a,beforeMethods:o,delayMethods:u,debounceMethods:c,throttleMethods:f,checkMethodList:i}}addDomEvent(t,e){t.callback=this.makeCallback(t,e),this.addBinding(t);var r=!!t.captures.length;ce[t.eventName]&&(r={passive:!0,capture:r}),Vt.addDomEvent(t.dom,t.eventName,t.callback,r)}makeCustomEventCallback(t,e){if("doubletab"===t.customEventName){var r=300;return t.delayMethods.length&&(r=+t.delayMethods[0].target),(...t)=>{this.doubleTab?(performance.now()-this.doubleTab.time<r&&e.apply(void 0,t),this.doubleTab=null):this.doubleTab={time:performance.now()}}}return e}bindingDomEvent([t,e,...r],s,i){let n=this.getDefaultEventObject(t,s);n.dom=this.getDefaultDomElement(e),n.delegate=r.join(" "),n.debounceMethods.length?i=Qt(i,+n.debounceMethods[0].target):n.throttleMethods.length&&(i=te(i,+n.throttleMethods[0].target)),i=this.makeCustomEventCallback(n,i),this.addDomEvent(n,i)}getEventNames(t){let e=[];return t.split(":").forEach(t=>{var r=t.split(":");e.push.apply(e,r)}),e}parseDomEvent(t){const e=this.context;let r=t.split(a).map(t=>t.trim()).filter(Boolean);var s=r.shift().split("@magic:domevent ")[1].split(" "),i=this.getEventNames(s[0]),n=e[t].bind(e);for(let t=0,e=i.length;t<e;t++)s[0]=i[t],this.bindingDomEvent(s,r,n)}}const fe=(t,e,r)=>{if("cssText"!==e)if("style"!==e)if("class"!==e)"callback"!==e||"function"!=typeof r?void 0===r?t.removeAttr(e):"TEXTAREA"===t.el.nodeName&&"value"===e||"text"===e||"textContent"===e?t.text(r):"innerHTML"===e||"html"===e?t.html(r):"htmlDiff"===e?t.updateDiff(r):"svgDiff"===e?t.updateSVGDiff(r):"value"===e?t.val(r):t.attr(e,r):r();else if(Array.isArray(r))t.addClass.apply(t,r.filter(Boolean));else if(function(t){return"object"==typeof t&&!Array.isArray(t)&&!function(t){return"number"==typeof t}(t)&&!se(t)&&null!==t}(r)){const e=Object.keys(r);for(var s=0,i=e.length;s<i;s++){const i=e[s];t.toggleClass(i,r[i])}}else t.el.className=r;else"string"!=typeof r&&t.css(r);else t.cssText(r)};class ge extends he{load(...t){this.bindData.apply(this,t)}bindData(...t){var e=this;this._bindMethods||(this._bindMethods=this.context.filterProps(i)),this._bindMethods.filter(e=>{if(!t.length)return!0;var[r,s]=e.split(a),[i,n]=r.split(" ");return t.indexOf(n)>-1}).forEach(async function(r){const s=e.context[r];var[r,i]=r.split(a);const n=e.getRef(i);let l=Ft;""!=n&&"string"==typeof n?l=Ht(n):"function"==typeof n&&(l=n);const o=r.split("@magic:bind ")[1];let h=e.context.refs[o];const c="function"==typeof l&&l.call(e.context);if(h&&c){const r=await s.call.apply(s,[e.context].concat(t));if(!r)return;const i=Object.keys(r);for(var d=0,u=i.length;d<u;d++){const t=i[d];fe(h,t,r[t])}}})}destroy(){this._bindMethods=void 0}}const me=new Map,ve=/[xy]/g;function Ee(){var t=(new Date).getTime();return"xxx12-xx-34xx".replace(ve,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})}function be(){var t=(new Date).getTime();return"idxxxxxxx".replace(ve,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})}let ye,Te,Ce=t=>t;const Ae=Jt.create("div");class Oe{constructor(t){this.cachedCallback={},this.callbacks={},this.commandes=[],this.editor=t}getCallbacks(t){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t]}setCallbacks(t,e=[]){this.callbacks[t]=e}debug(...t){var e;this.editor&&this.editor.config.get("debug")&&(e=console).debug.apply(e,t)}on(t,e,r,s=0,i=0,n=!1,a=!1,l=[]){var o=e;return s>0?o=Qt(e,s):i>0&&(o=te(e,i)),l.length&&(o=function(t,e,r){return(...s)=>{r.every(t=>e[t.target].apply(e,s))&&t.apply(e,s)}}(o,r,l)),this.getCallbacks(t).push({event:t,callback:o,context:r,originalCallback:e,enableAllTrigger:n,enableSelfTrigger:a}),this.debug("add message event",t,r.sourceName),()=>{this.off(t,e)}}off(t,e){this.debug("off message event",t),1==arguments.length?this.setCallbacks(t):2==arguments.length&&this.setCallbacks(t,this.getCallbacks(t).filter(t=>t.originalCallback!==e))}offAll(t){Object.keys(this.callbacks).forEach(e=>{this.setCallbacks(e,this.getCallbacks(e).filter(e=>e.context!==t))}),this.debug("off all message",t.sourceName)}getCachedCallbacks(t){return this.getCallbacks(t)}sendMessage(t,e,...r){Promise.resolve().then(()=>{var s=this.getCachedCallbacks(e);if(s)for(var i=0,n=s.length;i<n;i++){const e=s[i];e.enableSelfTrigger||(e.enableAllTrigger||e.originalCallback.source!==t)&&e.callback.apply(e.context,r)}})}nextSendMessage(t,e,...r){Promise.resolve().then(()=>{e.apply(void 0,r)})}triggerMessage(t,e,...r){Promise.resolve().then(()=>{var s=this.getCachedCallbacks(e);if(s)for(var i=0,n=s.length;i<n;i++){const e=s[i];e.originalCallback.source===t&&e.callback.apply(e.context,r)}else console.warn(e," is not valid event")})}emit(t,...e){ie(t)?t.apply(void 0,e):this.sendMessage.apply(this,[this.source,t].concat(e))}nextTick(t){this.nextSendMessage(this.source,t)}trigger(t,...e){ie(t)?t.apply(void 0,e):this.triggerMessage.apply(this,[this.source,t].concat(e))}}var Ne=t({start:(e,r={})=>{const s=Jt.create(r.container||document.body),i=new e(r,t({},r,{store:r.store||new Oe}));return i.render(s),i},UIElement:class extends class{constructor(t,e){this.state={},this.prevState={},this.refs={},this.children={},this._bindings=[],this.id=Ee(),this.__tempVariables=new Map,this.handlers=this.initializeHandler(),this.initializeProperty(t,e),this.initComponents()}initializeProperty(t,e={}){this.opt=t||{},this.parent=this.opt,this.props=e,this.source=Ee(),this.sourceName=this.constructor.name}initComponents(){this.childComponents=this.components()}initializeHandler(){return[new ge(this),new pe(this)]}initState(){return{}}setState(t={},e=!0){this.prevState=this.state,this.state=Object.assign({},this.state,t),e&&this.load()}toggleState(t,e=!0){this.setState({[t]:!this.state[t]},e)}variable(t){const e=`__ref__variable:${be()}`;return this.__tempVariables.set(e,t),e}recoverVariable(t){if(!1===se(t))return t;let e=t;return this.__tempVariables.has(t)&&(e=this.__tempVariables.get(t),this.__tempVariables.delete(t)),e}_reload(t){this.props=t,this.state={},this.setState(this.initState(),!1),this.refresh(!0)}render(t){this.$el=this.parseTemplate(le(ye||(ye=Ce`
        ${0}
      `),this.template())),this.refs.$el=this.$el,t&&t.append(this.$el),this.load(),this.afterRender()}initialize(){this.state=this.initState()}afterRender(){}components(){return{}}getRef(...t){const e=t.join("");return this.refs[e]}parseTemplate(t,e){Array.isArray(t)&&(t=t.join("")),t=t.trim();const r=Ae.html(t).children();for(var s=0,i=r.length;s<i;s++){const t=r[s];var n=t.attr("ref");n&&(this.refs[n]=t);for(var a=t.$$("[ref]"),l={},o=0,h=a.length;o<h;o++){const t=a[o],e=t.attr("ref");l[e]?console.warn(`${n} is duplicated. - ${this.sourceName}`,this):l[e]=!0,this.refs[e]=t}}return!e&&r.length?r[0]:Jt.create(Ae.createChildrenFragment())}parseProperty(e){let r={};for(var s of e.el.attributes)r[s.nodeName]=this.recoverVariable(s.nodeValue);return r.props&&(r=t({},r,Bt(r.props))),e.$$("property").forEach(t=>{const[e,s,i]=t.attrs("name","value","valueType");let n=s||t.text();"json"===i&&(n=JSON.parse(n)),r[e]=n}),r}parseSourceName(t){return t.parent?[t.sourceName].concat(this.parseSourceName(t.parent)):[t.sourceName]}getEventMachineComponent(t){return me.get(t)||this.childComponents[t]}parseComponent(){this.$el.$$("[refclass]").forEach(t=>{const e=this.getEventMachineComponent(t.attr("refclass"));if(e){let i=this.parseProperty(t),n=t.attr("ref");var r,s=null;this.children[n]?(s=this.children[n])._reload(i):(s=new e(this,i),this.children[n||s.id]=s,s.render()),s.renderTarget?(null==(r=s.$el)||r.appendTo(s.renderTarget),t.remove()):t.replace(s.$el)}else t.remove()}),ee(this.children,(t,e)=>{e&&e.clean()&&delete this.children[t]})}clean(){if(this.$el&&!this.$el.hasParent())return ee(this.children,(t,e)=>{e.clean()}),this.destroy(),this.$el=null,!0}refresh(){this.load()}_afterLoad(){this.runHandlers("initialize"),this.bindData(),this.parseComponent()}async load(...t){var e=this;this._loadMethods||(this._loadMethods=this.filterProps(s));const r=this._loadMethods.filter(e=>{const r=e.split("@magic:load ")[1].split(a).map(t=>t.trim())[0];return!t.length||t.indexOf(r)>-1});await r.forEach(async function(r){let s=r.split("@magic:load ")[1];var[i,...n]=s.split(a).map(t=>t.trim());n=n.map(t=>t.trim());const l=Boolean(n.filter(t=>w.includes(t)).length);if(e.refs[i]){var o,h=await(o=e[r]).call.apply(o,[e].concat(t));Array.isArray(h)&&(h=h.join(""));const s=e.parseTemplate(le(Te||(Te=Ce`${0}`),h),!0);l?e.refs[i].htmlDiff(s):e.refs[i].html(s)}}),this._afterLoad()}runHandlers(t="run",...e){this.handlers.forEach(r=>r[t].apply(r,e))}bindData(...t){this.runHandlers.apply(this,["load"].concat(t))}template(){return null}eachChildren(t){ie(t)&&ee(this.children,(e,r)=>{t(r)})}rerender(){var t=this.$el.parent();this.destroy(),this.render(t)}destroy(){this.eachChildren(t=>{t.destroy()}),this.runHandlers("destroy"),this.$el&&this.$el.remove(),this.$el=null,this.refs={},this.children={}}collectProps(){return this.__cachedMethodList||(this.__cachedMethodList=function(t,e=Zt){let r=t,s=[];do{if(0==r instanceof Object)break;const i=Object.getOwnPropertyNames(r).filter(r=>t&&ie(t[r])&&e(r));s.push.apply(s,i)}while(r=Object.getPrototypeOf(r));return s}(this,t=>0===t.indexOf("@magic:"))),this.__cachedMethodList}filterProps(t){return this.collectProps().filter(e=>e.match(t))}self(t){return t&&t.$dt&&t.$dt.is(t.target)}isAltKey(t){return t.altKey}isCtrlKey(t){return t.ctrlKey}isShiftKey(t){return t.shiftKey}isMetaKey(t){return t.metaKey||"Meta"==t.key||t.code.indexOf("Meta")>-1}isMouseLeftButton(t){return 1===t.buttons}isMouseRightButton(t){return 2===t.buttons}hasMouse(t){return"mouse"===t.pointerType}hasTouch(t){return"touch"===t.pointerType}hasPen(t){return"pen"===t.pointerType}preventDefault(t){return t.preventDefault(),!0}stopPropagation(t){return t.stopPropagation(),!0}}{constructor(t,e={}){super(t,e),this.__UID=new Set,e.store&&(this.__storeInstance=e.store),this.created(),this.initialize(),this.initializeStoreEvent()}setStore(t){this.__storeInstance=t}get $store(){return this.__storeInstance||this.parent.$store}created(){}getRealEventName(t,e=MULTI_PREFIX){var r=t.indexOf(e);return t.substr(r<0?0:r+e.length)}splitMethod(t,e,r=0){var[s,i]=oe(t,e);return[s.length?+i[0].target:r,s,i]}createLocalCallback(t,e){var r=e.bind(this);return r.displayName=`${this.sourceName}.${t}`,r.source=this.source,r}initializeStoreEvent(){this.filterProps(n).forEach(t=>{const e=this.getRealEventName(t,"@magic:subscribe "),[r,...s]=e.split(a),i=s.map(t=>t.trim()).filter(t=>this[t]).map(t=>({target:t})),[n,l]=this.splitMethod(s,"debounce"),[o,h]=this.splitMethod(s,"throttle"),[c,d]=this.splitMethod(s,"allTrigger"),[u,p]=this.splitMethod(s,"selfTrigger");e.split(a).filter(t=>-1===i.indexOf(t)&&-1===l.indexOf(t)&&-1===d.indexOf(t)&&-1===p.indexOf(t)&&-1===h.indexOf(t)).map(t=>t.trim()).filter(Boolean).forEach(e=>{if(ie(this[t])){var r=this.createLocalCallback(e,this[t]);this.$store.on(e,r,this,n,o,d.length,p.length,i)}})})}destoryStoreSUBSCRIBE(){this.$store.offAll(this)}destroy(){super.destroy(),this.destoryStoreSUBSCRIBE()}rerender(){super.rerender(),this.initialize(),this.initializeStoreEvent()}emit(t,...e){var r;this.$store.source=this.source,this.$store.sourceContext=this,(r=this.$store).emit.apply(r,[t].concat(e))}nextTick(t){this.$store.nextTick(t)}trigger(t,...e){var r;this.$store.source=this.source,(r=this.$store).trigger.apply(r,[t].concat(e))}broadcast(t,...e){Object.keys(this.children).forEach(r=>{var s;(s=this.children[r]).trigger.apply(s,[t].concat(e))})}on(t,e){this.$store.on(t,e)}off(t,e){this.$store.off(t,e)}subscribe(t,e=0,r=0){const s=`subscribe.${be()}`,i=this.createLocalCallback(s,t);return this.$store.on(s,i,this,e,r,!1,!0),s}},BaseStore:Oe,Dom:Jt},Kt,{registElement:function(t={}){Object.keys(t).forEach(e=>{me.has(e)||me.set(e,t[e])})}});export{Ne as default};
//# sourceMappingURL=sapa.modern.js.map
